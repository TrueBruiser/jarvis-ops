<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>MERIDIAN SCREENER // MARKET INTELLIGENCE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#050810;
      --panel:rgba(5,8,16,0.92);
      --g:#f0b429;
      --g2:#d49613;
      --b:#3b9eff;
      --r:#ff4757;
      --gr:#2ed573;
      --border:rgba(240,180,41,0.15);
      --border2:rgba(240,180,41,0.3);
      --text:#d8c9a3;
      --dim:#6b5e3f;
      --header:#0b0f1a;
      --uw:#00d4ff;
      --uw-dim:rgba(0,212,255,0.15);
      --buffett:#c8a45a;
    }
    html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:'JetBrains Mono',monospace}
    #app{display:flex;flex-direction:column;height:100vh;overflow:hidden}

    /* TOP BAR */
    #topbar{display:flex;align-items:center;height:44px;padding:0 16px;gap:16px;background:var(--header);border-bottom:1px solid var(--border2);flex-shrink:0;}
    .logo{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:900;color:var(--g);letter-spacing:3px;text-shadow:0 0 10px rgba(240,180,41,0.4);white-space:nowrap}
    .logo span{color:#fff;font-weight:400}
    #market-ticker{flex:1;overflow:hidden;display:flex;gap:16px;align-items:center}
    .tick-item{display:flex;gap:5px;align-items:center;white-space:nowrap;font-size:9px;letter-spacing:1px}
    .tick-sym{color:var(--g);font-weight:700}
    .tick-price{color:var(--text)}
    .tick-chg.up{color:var(--gr)}
    .tick-chg.dn{color:var(--r)}
    #clock{font-size:9px;color:var(--dim);letter-spacing:2px;white-space:nowrap}
    .topbar-btn{padding:4px 10px;border:1px solid var(--border);background:transparent;color:var(--dim);font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;}
    .topbar-btn:hover,.topbar-btn.active{border-color:var(--g);color:var(--g);background:rgba(240,180,41,0.08)}
    .topbar-btn.uw-btn{border-color:rgba(0,212,255,0.3);color:rgba(0,212,255,0.6)}
    .topbar-btn.uw-btn:hover,.topbar-btn.uw-btn.active{border-color:var(--uw);color:var(--uw);background:var(--uw-dim)}

    /* FILTER BAR */
    #filterbar{display:flex;align-items:center;gap:8px;padding:8px 16px;background:rgba(11,15,26,0.8);border-bottom:1px solid var(--border);flex-shrink:0;flex-wrap:wrap;}
    .filter-group{display:flex;align-items:center;gap:6px}
    .filter-label{font-size:8px;color:var(--dim);letter-spacing:1px;white-space:nowrap}
    .filter-select{background:rgba(240,180,41,0.04);border:1px solid var(--border);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:8px;padding:3px 6px;cursor:pointer;outline:none;letter-spacing:1px;}
    .filter-select:focus{border-color:var(--g)}
    .filter-input{background:rgba(240,180,41,0.04);border:1px solid var(--border);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:8px;padding:3px 6px;outline:none;width:70px;letter-spacing:1px;}
    .filter-input::placeholder{color:var(--dim)}
    .filter-input:focus{border-color:var(--g)}
    .filter-sep{width:1px;height:20px;background:var(--border)}
    #run-btn{padding:5px 14px;border:1px solid var(--g);background:rgba(240,180,41,0.1);color:var(--g);font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:2px;cursor:pointer;transition:all 0.2s;margin-left:auto;}
    #run-btn:hover{background:rgba(240,180,41,0.2);box-shadow:0 0 12px rgba(240,180,41,0.2)}
    #result-count{font-size:8px;color:var(--dim);letter-spacing:1px;white-space:nowrap}

    /* MAIN LAYOUT */
    #main{display:flex;flex:1;overflow:hidden;gap:0}

    /* TABLE AREA */
    #table-area{flex:1;display:flex;flex-direction:column;overflow:hidden}
    #table-wrap{flex:1;overflow:auto;scrollbar-width:thin;scrollbar-color:var(--border) transparent}
    #table-wrap::-webkit-scrollbar{width:5px;height:5px}
    #table-wrap::-webkit-scrollbar-track{background:transparent}
    #table-wrap::-webkit-scrollbar-thumb{background:var(--border)}
    #screener-table{width:100%;border-collapse:collapse;font-size:10px;letter-spacing:0.5px}
    #screener-table thead tr{background:var(--header);position:sticky;top:0;z-index:10}
    #screener-table th{padding:8px 10px;text-align:right;color:var(--dim);font-size:8px;letter-spacing:1px;border-bottom:1px solid var(--border2);cursor:pointer;white-space:nowrap;user-select:none;font-weight:400;}
    #screener-table th:first-child{text-align:left;padding-left:14px}
    #screener-table th:hover{color:var(--g)}
    #screener-table tbody tr{border-bottom:1px solid rgba(240,180,41,0.04);cursor:pointer;transition:background 0.1s;}
    #screener-table tbody tr:hover{background:rgba(240,180,41,0.04)}
    #screener-table tbody tr.selected{background:rgba(240,180,41,0.08)}
    #screener-table td{padding:7px 10px;text-align:right;white-space:nowrap}
    #screener-table td:first-child{text-align:left;padding-left:14px}
    .sym-cell{display:flex;flex-direction:column;gap:2px}
    .sym{color:var(--g);font-weight:700;font-size:11px}
    .sname{color:var(--dim);font-size:8px;letter-spacing:0;max-width:120px;overflow:hidden;text-overflow:ellipsis}
    .up{color:var(--gr)}
    .dn{color:var(--r)}
    .neutral{color:var(--text)}
    .gold{color:var(--g)}
    .badge{display:inline-block;padding:1px 5px;font-size:7px;letter-spacing:1px;border:1px solid;border-radius:2px}
    .badge-tech{border-color:rgba(59,158,255,0.4);color:#3b9eff;background:rgba(59,158,255,0.06)}
    .badge-health{border-color:rgba(46,213,115,0.4);color:#2ed573;background:rgba(46,213,115,0.06)}
    .badge-fin{border-color:rgba(240,180,41,0.4);color:var(--g);background:rgba(240,180,41,0.06)}
    .badge-energy{border-color:rgba(255,165,0,0.4);color:orange;background:rgba(255,165,0,0.06)}
    .badge-consumer{border-color:rgba(255,100,100,0.3);color:#ff7b7b;background:rgba(255,100,100,0.06)}
    .badge-ind{border-color:rgba(180,180,180,0.3);color:#bbb;background:rgba(180,180,180,0.06)}
    .badge-util{border-color:rgba(100,200,200,0.4);color:#64c8c8;background:rgba(100,200,200,0.06)}
    .badge-mat{border-color:rgba(180,130,80,0.4);color:#b48250;background:rgba(180,130,80,0.06)}
    .badge-re{border-color:rgba(200,164,90,0.4);color:#c8a45a;background:rgba(200,164,90,0.06)}
    .badge-comm{border-color:rgba(170,130,255,0.4);color:#aa82ff;background:rgba(170,130,255,0.06)}
    .vol-bar{display:inline-block;height:3px;background:var(--g);opacity:0.5;vertical-align:middle;margin-left:4px;max-width:40px}
    .whale-tag{display:inline-block;padding:1px 4px;font-size:7px;border:1px solid rgba(0,212,255,0.4);color:var(--uw);background:rgba(0,212,255,0.06);border-radius:2px;margin-left:4px;}

    /* HEATMAP */
    #heatmap-view{flex:1;display:none;overflow:auto;padding:12px}
    #heatmap-view.visible{display:flex;flex-wrap:wrap;gap:4px;align-content:flex-start}
    .hm-cell{display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;border:1px solid rgba(255,255,255,0.04);transition:all 0.2s;min-width:60px;min-height:50px;}
    .hm-cell:hover{border-color:rgba(240,180,41,0.4);z-index:1}
    .hm-sym{font-size:9px;font-weight:700;letter-spacing:1px}
    .hm-chg{font-size:8px;letter-spacing:0.5px}

    /* STATUS BAR */
    #statusbar{display:flex;align-items:center;gap:16px;padding:4px 16px;background:var(--header);border-top:1px solid var(--border);flex-shrink:0;font-size:8px;color:var(--dim);letter-spacing:1px;}
    .bb-item{display:flex;gap:6px;align-items:center}
    .bb-key{color:var(--dim)}
    .bb-val{color:var(--text)}
    .bb-sep{width:1px;height:12px;background:var(--border)}

    /* DETAIL PANEL */
    #detail-panel{width:320px;border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0;background:rgba(5,8,16,0.98)}
    #dp-header{padding:12px 14px 10px;border-bottom:1px solid var(--border);flex-shrink:0}
    #dp-sym{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:900;color:var(--g)}
    #dp-name{font-size:9px;color:var(--dim);margin-top:2px;letter-spacing:1px}
    #dp-price-row{display:flex;align-items:baseline;gap:10px;margin-top:8px}
    #dp-price{font-size:22px;font-weight:700;color:#fff;font-family:'Orbitron',monospace}
    #dp-chg{font-size:11px;font-weight:700}
    #dp-state{font-size:8px;color:var(--dim);letter-spacing:1px;margin-left:auto}
    #dp-tabs{display:flex;gap:0;flex-shrink:0;border-bottom:1px solid var(--border)}
    .dp-tab{flex:1;padding:7px 4px;text-align:center;font-size:8px;letter-spacing:1px;cursor:pointer;color:var(--dim);border-bottom:2px solid transparent;transition:all 0.2s;white-space:nowrap}
    .dp-tab:hover{color:var(--text)}
    .dp-tab.active{color:var(--g);border-color:var(--g)}
    .dp-tab.uw-tab{font-size:7px}
    .dp-tab.uw-tab.active{color:var(--uw);border-color:var(--uw)}
    #dp-body{flex:1;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--border) transparent}
    #dp-body::-webkit-scrollbar{width:3px}
    #dp-body::-webkit-scrollbar-thumb{background:var(--border)}
    .dp-pane{display:none;padding:12px 14px}
    .dp-pane.active{display:block}
    #dp-chart-wrap{height:120px;margin-bottom:12px}
    #dp-chart{width:100%!important;height:100%!important}
    .dp-section{margin-bottom:14px}
    .dp-section-title{font-size:8px;letter-spacing:2px;color:var(--dim);margin-bottom:8px;padding-bottom:4px;border-bottom:1px solid var(--border)}
    .dp-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
    .dp-key{font-size:9px;color:var(--dim);letter-spacing:0.5px}
    .dp-val{font-size:9px;color:var(--text)}
    .dp-val.hi{color:var(--gr)}
    .dp-val.lo{color:var(--r)}
    .dp-val.gold{color:var(--g)}

    /* BUFFETT PANEL */
    .buffett-oracle{background:linear-gradient(135deg,rgba(200,164,90,0.06),rgba(200,164,90,0.02));border:1px solid rgba(200,164,90,0.2);border-radius:4px;padding:12px;margin-bottom:14px;position:relative;overflow:hidden;}
    .buffett-oracle::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(200,164,90,0.5),transparent)}
    .buffett-portrait{display:flex;align-items:center;gap:8px;margin-bottom:10px}
    .buffett-icon{width:28px;height:28px;border-radius:50%;background:rgba(200,164,90,0.15);border:1px solid rgba(200,164,90,0.3);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
    .buffett-name{font-size:8px;color:var(--buffett);letter-spacing:2px;font-weight:700}
    .buffett-title{font-size:7px;color:var(--dim);letter-spacing:1px}
    .buffett-quote{font-size:9px;color:#d4b896;line-height:1.6;font-style:italic;margin-bottom:8px}
    .buffett-verdict{display:flex;align-items:center;gap:6px;padding:6px 8px;background:rgba(200,164,90,0.06);border-left:2px solid var(--buffett)}
    .buffett-verdict-label{font-size:8px;letter-spacing:1px;color:var(--buffett);font-weight:700}
    .buffett-verdict-text{font-size:8px;color:var(--text)}
    .buffett-signal{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .b-signal{padding:2px 6px;font-size:7px;border:1px solid;border-radius:2px;letter-spacing:1px}
    .b-buy{border-color:rgba(46,213,115,0.4);color:var(--gr);background:rgba(46,213,115,0.06)}
    .b-hold{border-color:rgba(240,180,41,0.4);color:var(--g);background:rgba(240,180,41,0.06)}
    .b-caution{border-color:rgba(255,71,87,0.4);color:var(--r);background:rgba(255,71,87,0.06)}
    .b-avoid{border-color:rgba(255,71,87,0.5);color:#ff2233;background:rgba(255,71,87,0.1)}

    /* AI ANALYSIS */
    #dp-ai-text{font-size:9px;color:var(--text);line-height:1.7;padding:12px 14px;}

    /* UW PANEL */
    #uw-panel{padding:12px 14px;}
    .uw-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .uw-logo{font-size:9px;color:var(--uw);letter-spacing:2px;font-weight:700}
    .uw-badge{font-size:7px;padding:2px 6px;border:1px solid rgba(0,212,255,0.3);color:rgba(0,212,255,0.7);letter-spacing:1px}
    .uw-key-section{margin-bottom:14px}
    .uw-key-label{font-size:8px;color:var(--dim);letter-spacing:1px;margin-bottom:6px}
    .uw-key-input{width:100%;background:rgba(0,212,255,0.04);border:1px solid rgba(0,212,255,0.2);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:8px;padding:6px 8px;outline:none;letter-spacing:1px;}
    .uw-key-input::placeholder{color:var(--dim)}
    .uw-key-input:focus{border-color:var(--uw)}
    .uw-connect-btn{margin-top:6px;padding:5px 12px;border:1px solid rgba(0,212,255,0.4);background:rgba(0,212,255,0.06);color:var(--uw);font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;cursor:pointer;width:100%;transition:all 0.2s}
    .uw-connect-btn:hover{background:rgba(0,212,255,0.12);box-shadow:0 0 12px rgba(0,212,255,0.15)}
    .uw-flow-item{padding:8px 0;border-bottom:1px solid rgba(0,212,255,0.06);display:flex;flex-direction:column;gap:4px}
    .uw-flow-top{display:flex;align-items:center;gap:8px}
    .uw-flow-sym{font-size:10px;font-weight:700;color:var(--uw)}
    .uw-flow-type{font-size:7px;padding:1px 4px;border:1px solid;border-radius:2px;letter-spacing:1px}
    .uw-call{border-color:rgba(46,213,115,0.5);color:var(--gr)}
    .uw-put{border-color:rgba(255,71,87,0.5);color:var(--r)}
    .uw-flow-premium{font-size:9px;color:var(--g);margin-left:auto}
    .uw-flow-detail{font-size:8px;color:var(--dim);letter-spacing:0.5px}
    .uw-tide-bar{display:flex;height:24px;border-radius:2px;overflow:hidden;margin-bottom:6px}
    .uw-tide-call{background:linear-gradient(90deg,rgba(46,213,115,0.4),rgba(46,213,115,0.2))}
    .uw-tide-put{background:linear-gradient(90deg,rgba(255,71,87,0.2),rgba(255,71,87,0.4))}
    .uw-status{font-size:9px;color:var(--dim);text-align:center;padding:20px;letter-spacing:1px}
    .uw-status a{color:var(--uw);cursor:pointer;text-decoration:underline}

    /* MARKET-WIDE UW PANEL */
    #uw-market-panel{display:none;position:fixed;top:0;right:0;bottom:0;width:360px;background:rgba(5,8,16,0.98);border-left:1px solid rgba(0,212,255,0.2);z-index:100;display:none;flex-direction:column}
    #uw-market-panel.open{display:flex}
    #uwmp-header{padding:14px;border-bottom:1px solid rgba(0,212,255,0.15);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
    #uwmp-title{font-size:10px;color:var(--uw);letter-spacing:3px;font-weight:700}
    #uwmp-close{cursor:pointer;color:var(--dim);font-size:16px;line-height:1}
    #uwmp-body{flex:1;overflow-y:auto;padding:14px;scrollbar-width:thin}

    /* LOADING */
    #loading{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:999}
    .load-logo{font-family:'Orbitron',sans-serif;font-size:24px;font-weight:900;color:var(--g);letter-spacing:6px;margin-bottom:20px;text-shadow:0 0 30px rgba(240,180,41,0.4)}
    .load-bar{width:280px;height:2px;background:rgba(240,180,41,0.1);border-radius:1px;overflow:hidden;margin-bottom:12px}
    .load-progress{height:100%;background:var(--g);width:0;transition:width 0.3s;box-shadow:0 0 8px rgba(240,180,41,0.5)}
    #load-msg{font-size:9px;color:var(--dim);letter-spacing:2px}
    .load-sub{font-size:8px;color:rgba(107,94,63,0.5);margin-top:6px;letter-spacing:1px}
  </style>
</head>
<body>
<div id="loading">
  <div class="load-logo">MERIDIAN</div>
  <div class="load-bar"><div class="load-progress" id="load-bar"></div></div>
  <div id="load-msg">INITIALIZING...</div>
  <div class="load-sub">RUSSELL 3000 + UNUSUAL WHALES INTEGRATION</div>
</div>
<div id="app" style="display:none">
  <div id="topbar">
    <div class="logo">MERIDIAN <span>// SCREENER</span></div>
    <div id="market-ticker"></div>
    <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
      <button class="topbar-btn" id="btn-table" onclick="switchView('table')" style="border-color:var(--g);color:var(--g)">TABLE</button>
      <button class="topbar-btn" id="btn-heat" onclick="switchView('heat')">HEAT</button>
      <button class="topbar-btn uw-btn" id="btn-uw" onclick="toggleUWPanel()">üê≥ UW FLOW</button>
      <div class="bb-sep"></div>
      <div id="clock"></div>
    </div>
  </div>
  <div id="filterbar">
    <div class="filter-group">
      <span class="filter-label">SECTOR</span>
      <select class="filter-select" id="f-sector">
        <option value="">ALL</option>
        <option>Technology</option><option>Healthcare</option><option>Financials</option>
        <option>Consumer Cyclical</option><option>Consumer Defensive</option>
        <option>Industrials</option><option>Energy</option><option>Materials</option>
        <option>Real Estate</option><option>Utilities</option><option>Communication Services</option>
      </select>
    </div>
    <div class="filter-sep"></div>
    <div class="filter-group">
      <span class="filter-label">MKT CAP</span>
      <select class="filter-select" id="f-mktcap">
        <option value="">ALL</option>
        <option value="mega">MEGA (200B+)</option>
        <option value="large">LARGE (10-200B)</option>
        <option value="mid">MID (2-10B)</option>
        <option value="small">SMALL (&lt;2B)</option>
      </select>
    </div>
    <div class="filter-sep"></div>
    <div class="filter-group">
      <span class="filter-label">P/E MAX</span>
      <input class="filter-input" id="f-pe" placeholder="e.g. 25">
    </div>
    <div class="filter-group">
      <span class="filter-label">DIV% MIN</span>
      <input class="filter-input" id="f-div" placeholder="e.g. 2">
    </div>
    <div class="filter-sep"></div>
    <div class="filter-group">
      <span class="filter-label">MOVE</span>
      <select class="filter-select" id="f-chg">
        <option value="">ALL</option>
        <option value="up3">‚ñ≤ 3%+</option><option value="up1">‚ñ≤ 1%+</option>
        <option value="dn1">‚ñº 1%+</option><option value="dn3">‚ñº 3%+</option>
      </select>
    </div>
    <div class="filter-group">
      <span class="filter-label">VOLUME</span>
      <select class="filter-select" id="f-vol">
        <option value="">ALL</option>
        <option value="2x">2x AVG+</option><option value="3x">3x AVG+</option>
      </select>
    </div>
    <div class="filter-group">
      <span class="filter-label">52W</span>
      <select class="filter-select" id="f-52w">
        <option value="">ALL</option>
        <option value="near_high">NEAR HIGH (90%+)</option>
        <option value="near_low">NEAR LOW (&lt;15%)</option>
      </select>
    </div>
    <div class="filter-sep"></div>
    <div class="filter-group">
      <span class="filter-label">SEARCH</span>
      <input class="filter-input" id="f-search" placeholder="SYM or NAME" oninput="runScreen()">
    </div>
    <span id="result-count"></span>
    <button id="run-btn" onclick="runScreen()">‚óà SCREEN</button>
  </div>
  <div id="main">
    <div id="table-area">
      <div id="table-wrap">
        <table id="screener-table">
          <thead>
            <tr>
              <th style="text-align:left" onclick="sortBy('sym')">SYMBOL ‚ñæ</th>
              <th onclick="sortBy('price')">PRICE</th>
              <th onclick="sortBy('chgPct')">CHG%</th>
              <th onclick="sortBy('mktCap')">MKT CAP</th>
              <th onclick="sortBy('pe')">P/E</th>
              <th onclick="sortBy('divYield')">DIV%</th>
              <th onclick="sortBy('beta')">BETA</th>
              <th onclick="sortBy('volume')">VOLUME</th>
              <th onclick="sortBy('h52')">52W H</th>
              <th onclick="sortBy('l52')">52W L</th>
            </tr>
          </thead>
          <tbody id="screener-body"></tbody>
        </table>
      </div>
      <div id="heatmap-view"></div>
    </div>
    <div id="detail-panel">
      <div id="dp-header">
        <div id="dp-sym">SELECT A STOCK</div>
        <div id="dp-name">Click any row to view details</div>
        <div id="dp-price-row">
          <div id="dp-price" style="font-size:14px;color:var(--dim)">‚Äî</div>
          <div id="dp-chg"></div>
          <div id="dp-state"></div>
        </div>
      </div>
      <div id="dp-tabs">
        <div class="dp-tab active" onclick="dpTab('stats')" id="tab-stats">STATS</div>
        <div class="dp-tab" onclick="dpTab('buffett')" id="tab-buffett">üè¶ ORACLE</div>
        <div class="dp-tab" onclick="dpTab('analysis')" id="tab-analysis">ANALYSIS</div>
        <div class="dp-tab uw-tab" onclick="dpTab('uw')" id="tab-uw">üê≥ WHALES</div>
      </div>
      <div id="dp-body">
        <div class="dp-pane active" id="pane-stats">
          <div id="dp-chart-wrap"><canvas id="dp-chart"></canvas></div>
          <div id="dp-stats"></div>
        </div>
        <div class="dp-pane" id="pane-buffett">
          <div id="dp-buffett"></div>
        </div>
        <div class="dp-pane" id="pane-analysis">
          <div id="dp-ai-text" style="color:var(--dim);font-size:9px;padding:20px;text-align:center">SELECT A STOCK TO VIEW ANALYSIS</div>
        </div>
        <div class="dp-pane" id="pane-uw">
          <div id="uw-panel"></div>
        </div>
      </div>
    </div>
  </div>
  <div id="statusbar">
    <div class="bb-item"><span class="bb-key">INDEX</span><span class="bb-val">RUSSELL 3000</span></div>
    <div class="bb-sep"></div>
    <div class="bb-item"><span class="bb-key">STOCKS</span><span class="bb-val" id="bb-total">‚Äî</span></div>
    <div class="bb-sep"></div>
    <div class="bb-item"><span class="bb-key">MARKET</span><span class="bb-val" id="bb-market" style="color:var(--g)">‚Äî</span></div>
    <div class="bb-sep"></div>
    <div class="bb-item"><span class="bb-key">UPDATED</span><span class="bb-val" id="bb-update">‚Äî</span></div>
    <div class="bb-sep"></div>
    <div class="bb-item"><span class="bb-key">UW</span><span class="bb-val" id="bb-uw" style="color:var(--dim)">DISCONNECTED</span></div>
    <div class="bb-sep"></div>
    <div class="bb-item" style="margin-left:auto"><span class="bb-key">MERIDIAN v3.0 // RUSSELL 3000 + UNUSUAL WHALES</span></div>
  </div>
</div>

<!-- UW Market Panel -->
<div id="uw-market-panel">
  <div id="uwmp-header">
    <span id="uwmp-title">üê≥ UNUSUAL WHALES FLOW</span>
    <span id="uwmp-close" onclick="toggleUWPanel()">‚úï</span>
  </div>
  <div id="uwmp-body">
    <div id="uwmp-content"></div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// WARREN BUFFETT WISDOM ENGINE
// Contextual quotes and verdicts based on fundamentals
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BUFFETT_PRINCIPLES = {
  value: [
    { quote: "Whether we're talking about socks or stocks, I like buying quality merchandise when it is marked down.", signal: 'buy', tags: ['VALUE PLAY', 'MOAT CHECK'] },
    { quote: "Price is what you pay. Value is what you get. A great company at a fair price beats a fair company at a great price.", signal: 'buy', tags: ['FAIR VALUE', 'QUALITY FIRST'] },
    { quote: "It's far better to buy a wonderful company at a fair price than a fair company at a wonderful price.", signal: 'buy', tags: ['QUALITY MOAT'] },
    { quote: "The most common cause of low prices is pessimism... we want to do business in such an environment, not because we like pessimism but because we like the prices it produces.", signal: 'buy', tags: ['CONTRARIAN', 'PATIENT'] },
  ],
  overvalued: [
    { quote: "Most people get interested in stocks when everyone else is. The time to get interested is when no one else is.", signal: 'caution', tags: ['OVERHEATED', 'WAIT'] },
    { quote: "Be fearful when others are greedy, and greedy when others are fearful.", signal: 'caution', tags: ['GREED SIGNAL', 'PATIENCE'] },
    { quote: "The stock market is a device for transferring money from the impatient to the patient. High valuations test patience.", signal: 'hold', tags: ['HIGH MULT', 'PATIENCE'] },
    { quote: "An investor needs to do very few things right as long as he or she avoids big mistakes. Overpaying is a big mistake.", signal: 'caution', tags: ['VALUATION RISK'] },
  ],
  dividend: [
    { quote: "Do not save what is left after spending; instead spend what is left after saving. A company paying dividends signals discipline.", signal: 'buy', tags: ['INCOME', 'DISCIPLINED'] },
    { quote: "My favorite holding period is forever. Companies with consistent dividends reward the long-term investor.", signal: 'buy', tags: ['HOLD FOREVER', 'INCOME'] },
    { quote: "Dividends aren't just money ‚Äî they're proof of cash generation. Real businesses make real cash.", signal: 'buy', tags: ['CASH PROOF', 'BUY'] },
  ],
  moat: [
    { quote: "In business, I look for economic castles protected by unbreachable moats. Wide moats compound beautifully.", signal: 'buy', tags: ['WIDE MOAT', 'COMPOUNDING'] },
    { quote: "The key to investing is not assessing how much an industry will affect society, or how much it will grow, but rather determining the competitive advantage.", signal: 'buy', tags: ['MOAT ANALYSIS'] },
    { quote: "A truly wonderful business is like a great painting ‚Äî it becomes more valuable with time.", signal: 'buy', tags: ['QUALITY ASSET'] },
  ],
  volatile: [
    { quote: "Risk comes from not knowing what you're doing. High beta isn't risk if you understand the business deeply.", signal: 'caution', tags: ['HIGH BETA', 'RESEARCH FIRST'] },
    { quote: "I never attempt to make money on the stock market. I buy on the assumption that they could close the market the next day.", signal: 'hold', tags: ['BUSINESS FOCUS', 'VOLATILE'] },
    { quote: "Our favorite holding period is forever ‚Äî but that requires avoiding businesses where forever looks uncertain.", signal: 'caution', tags: ['CAUTION', 'CLARITY'] },
  ],
  lowpe: [
    { quote: "Wonderful companies that make money are often found hiding in plain sight ‚Äî low multiples on proven earnings.", signal: 'buy', tags: ['UNDERVALUED', 'EARNINGS QUALITY'] },
    { quote: "The best thing that happens to us is when a great company gets into temporary trouble. We want to buy when the fear is maximum.", signal: 'buy', tags: ['OPPORTUNITY', 'VALUE'] },
    { quote: "If a business is good enough, it will earn a good rate of return on equity without much leverage. Low P/E on strong ROE is a gift.", signal: 'buy', tags: ['ROE FOCUS', 'VALUE BUY'] },
  ],
  highpe: [
    { quote: "The stock market is a no-called-strike game. You don't have to swing at everything ‚Äî wait for the fat pitch.", signal: 'avoid', tags: ['WAIT', 'TOO EXPENSIVE'] },
    { quote: "Growth at a reasonable price is a virtue. Growth at an unreasonable price is a speculation.", signal: 'avoid', tags: ['SPECULATION RISK'] },
    { quote: "Time is the friend of the wonderful company, the enemy of the mediocre. At sky-high P/E, it better be wonderful.", signal: 'caution', tags: ['MUST DELIVER', 'HIGH STAKES'] },
  ],
  cash: [
    { quote: "Never forget that you're building an emergency fund before you build a portfolio. I always keep powder dry.", signal: 'hold', tags: ['CASH IS KING'] },
    { quote: "Cash is to a business like oxygen is to a person ‚Äî nobody thinks about it when it is present, but all that's on their mind when it is absent.", signal: 'hold', tags: ['CASH FLOW'] },
  ],
  nodividend_growth: [
    { quote: "If the business does well, the stock eventually follows. Many compounders reinvest rather than pay dividends ‚Äî both paths can work.", signal: 'hold', tags: ['COMPOUNDER', 'REINVEST'] },
    { quote: "Reinvested earnings at high rates of return beat dividends every time ‚Äî if management is exceptional.", signal: 'buy', tags: ['HIGH ROIC', 'COMPOUNDER'] },
  ],
  sector_buffett: {
    'Financials': { quote: "We like financial businesses with a durable moat ‚Äî simple business model, conservative leverage, long track record.", signal: 'buy', tags: ['BUFFETT TURF', 'PROVEN MODEL'] },
    'Consumer Defensive': { quote: "The consumer brands I love have one thing in common: pricing power. People pay up, year after year, without thinking twice.", signal: 'buy', tags: ['PRICING POWER', 'CONSUMER MOAT'] },
    'Energy': { quote: "Energy is a commodity business ‚Äî it can be wonderful or awful depending on the cycle. Know where you are in the cycle.", signal: 'hold', tags: ['CYCLICAL', 'CYCLE AWARE'] },
    'Technology': { quote: "Technology changes the world, but identifying long-term winners is hard. I missed Google and Amazon. I bought Apple when it became a consumer products company.", signal: 'caution', tags: ['HARD TO PREDICT', 'MOAT REQUIRED'] },
    'Healthcare': { quote: "I've struggled with healthcare investing because government policy can change the game overnight. Durable revenue matters most.", signal: 'hold', tags: ['POLICY RISK', 'DURABLE REVENUE'] },
    'Real Estate': { quote: "Real estate is a great business ‚Äî land doesn't depreciate and people always need a place to live or work.", signal: 'hold', tags: ['DURABLE ASSET'] },
  }
};

function getBuffettWisdom(s) {
  const pe = s.pe;
  const div = s.divYield;
  const beta = s.beta;
  const pct52 = s.h52 && s.l52 ? ((s.price - s.l52) / (s.h52 - s.l52) * 100) : null;

  let category = 'value';
  let extra = null;

  // Determine primary category
  if (pe && pe < 15 && pe > 0) category = 'lowpe';
  else if (pe && pe > 50) category = 'highpe';
  else if (div && div > 3.5) category = 'dividend';
  else if (beta && beta > 1.6) category = 'volatile';
  else if (pct52 !== null && pct52 > 88) category = 'overvalued';
  else if (pct52 !== null && pct52 < 20) category = 'value';
  else if (!div || div < 0.5) category = 'nodividend_growth';
  else category = 'moat';

  // Pick a quote from the category
  const pool = BUFFETT_PRINCIPLES[category] || BUFFETT_PRINCIPLES.value;
  const chosen = pool[Math.floor((s.sym.charCodeAt(0) + s.sym.charCodeAt(1||0)) % pool.length)];

  // Check for sector-specific wisdom
  const sectorQuote = BUFFETT_PRINCIPLES.sector_buffett[s.sector];

  // Generate the verdict
  let verdict = '';
  let verdictClass = '';
  if (category === 'lowpe') { verdict = `P/E of ${pe?.toFixed(1)} is below fair value territory. Buffett looks for exactly this.`; verdictClass = 'b-buy'; }
  else if (category === 'highpe') { verdict = `P/E of ${pe?.toFixed(1)} prices in years of perfect execution. Buffett would wait.`; verdictClass = 'b-avoid'; }
  else if (category === 'dividend') { verdict = `${div?.toFixed(1)}% yield signals cash discipline. Buffett approves of proven cash generation.`; verdictClass = 'b-buy'; }
  else if (category === 'volatile') { verdict = `Beta of ${beta?.toFixed(2)} means high swings. Understand the business before buying volatility.`; verdictClass = 'b-caution'; }
  else if (category === 'overvalued') { verdict = `Near 52W high at ${pct52?.toFixed(0)}% range. Buffett says: patience is the only correct response.`; verdictClass = 'b-hold'; }
  else if (category === 'value') { verdict = `Down from highs, fundamentals may be intact. Buffett's favorite setup ‚Äî fear-driven pricing.`; verdictClass = 'b-buy'; }
  else if (category === 'moat') { verdict = `Check for durable competitive advantages. Buffett demands a moat before pulling the trigger.`; verdictClass = 'b-hold'; }
  else { verdict = `No dividend, but high-return reinvestment can create more wealth. Judge management's capital allocation.`; verdictClass = 'b-hold'; }

  // Buffett's key metrics check
  const metrics = [];
  if (pe && pe < 20) metrics.push({ label: '‚úì REASONABLE P/E', cls: 'b-buy' });
  if (pe && pe > 40) metrics.push({ label: '‚ö† HIGH MULT', cls: 'b-avoid' });
  if (div && div > 2) metrics.push({ label: '‚úì DIVIDEND', cls: 'b-buy' });
  if (beta && beta < 0.8) metrics.push({ label: '‚úì LOW BETA', cls: 'b-buy' });
  if (beta && beta > 1.5) metrics.push({ label: '‚ö† HIGH BETA', cls: 'b-caution' });
  if (s.sector === 'Consumer Defensive' || s.sector === 'Financials') metrics.push({ label: '‚úì BUFFETT SECTOR', cls: 'b-buy' });
  if (s.mktCap > 50) metrics.push({ label: '‚úì LARGE CAP STABILITY', cls: 'b-hold' });

  return { chosen, verdict, verdictClass, metrics, sectorQuote };
}

function renderBuffettPanel(s) {
  const wisdom = getBuffettWisdom(s);
  const { chosen, verdict, verdictClass, metrics, sectorQuote } = wisdom;

  let html = `
    <div class="buffett-oracle">
      <div class="buffett-portrait">
        <div class="buffett-icon">üß†</div>
        <div>
          <div class="buffett-name">WARREN E. BUFFETT</div>
          <div class="buffett-title">ORACLE OF OMAHA // BERKSHIRE HATHAWAY</div>
        </div>
      </div>
      <div class="buffett-quote">"${chosen.quote}"</div>
      <div class="buffett-verdict">
        <span class="buffett-verdict-label">VERDICT //</span>
        <span class="buffett-verdict-text">${verdict}</span>
      </div>
      <div class="buffett-signal">
        ${metrics.map(m => `<span class="b-signal ${m.cls}">${m.label}</span>`).join('')}
        <span class="b-signal ${verdictClass}">${chosen.signal.toUpperCase()}</span>
      </div>
    </div>`;

  if (sectorQuote) {
    html += `
    <div class="buffett-oracle" style="margin-top:0">
      <div class="buffett-portrait">
        <div class="buffett-icon">üè≠</div>
        <div>
          <div class="buffett-name">ON ${s.sector.toUpperCase()}</div>
          <div class="buffett-title">SECTOR-SPECIFIC WISDOM</div>
        </div>
      </div>
      <div class="buffett-quote">"${sectorQuote.quote}"</div>
      <div class="buffett-signal">
        ${sectorQuote.tags.map(t => `<span class="b-signal ${sectorQuote.signal === 'buy' ? 'b-buy' : sectorQuote.signal === 'caution' ? 'b-caution' : 'b-hold'}">${t}</span>`).join('')}
      </div>
    </div>`;
  }

  // Buffett's 5 pillars checklist
  html += `
    <div class="dp-section">
      <div class="dp-section-title">BUFFETT'S 5 PILLARS // ${s.sym}</div>
      ${pillarsHTML(s)}
    </div>`;

  document.getElementById('dp-buffett').innerHTML = html;
}

function pillarsHTML(s) {
  const checks = [
    { label: 'Understandable Business', pass: !['Technology'].includes(s.sector) || s.mktCap > 500, note: s.sector },
    { label: 'Proven Track Record', pass: s.mktCap > 20, note: s.mktCap > 20 ? 'Large established company' : 'Smaller / newer' },
    { label: 'Favorable Prospects', pass: s.chgPct > -20 && (s.pe === null || s.pe < 80), note: s.pe ? `P/E ${s.pe.toFixed(1)}` : 'No P/E data' },
    { label: 'Able & Trustworthy Management', pass: true, note: 'Research required ‚Äî check 10-K' },
    { label: 'Sensible Price', pass: !s.pe || (s.pe > 0 && s.pe < 30), note: s.pe ? `P/E ${s.pe.toFixed(1)} ${s.pe < 30 ? '‚úì' : '‚Äî elevated'}` : 'N/A' },
  ];
  return checks.map(c => `
    <div class="dp-row">
      <span class="dp-key" style="font-size:8px">${c.pass ? '‚óà' : '‚óã'} ${c.label}</span>
      <span class="dp-val" style="font-size:8px;color:${c.pass ? 'var(--gr)' : 'var(--dim)'}">${c.note}</span>
    </div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// UNUSUAL WHALES INTEGRATION
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let uwToken = localStorage.getItem('uw_token') || '';
let uwConnected = false;

async function uwFetch(endpoint, params = {}) {
  if (!uwToken) return null;
  const url = new URL('https://api.unusualwhales.com' + endpoint);
  Object.entries(params).forEach(([k,v]) => url.searchParams.set(k, v));
  const headers = {
    'Authorization': `Bearer ${uwToken}`,
    'UW-CLIENT-API-ID': '100001',
  };
  const proxied = `https://api.allorigins.win/raw?url=${encodeURIComponent(url.toString())}`;
  try {
    const r = await fetch(proxied, { signal: AbortSignal.timeout(8000), headers: {} });
    if (!r.ok) return null;
    const d = await r.json();
    // allorigins returns data as-is if it's the raw response
    return d;
  } catch(e) {
    // Try direct
    try {
      const r2 = await fetch(url.toString(), { headers, signal: AbortSignal.timeout(8000) });
      if (!r2.ok) return null;
      return await r2.json();
    } catch(e2) { return null; }
  }
}

function saveUWToken() {
  const val = document.getElementById('uw-token-input')?.value?.trim();
  if (val) {
    uwToken = val;
    localStorage.setItem('uw_token', val);
    uwConnected = true;
    document.getElementById('bb-uw').textContent = 'CONNECTED';
    document.getElementById('bb-uw').style.color = 'var(--uw)';
  }
  renderUWPanel();
}

function renderUWKeySection() {
  return `
    <div class="uw-key-section">
      <div class="uw-key-label">API TOKEN</div>
      <input class="uw-key-input" id="uw-token-input" type="password" placeholder="Bearer token from unusualwhales.com" value="${uwToken ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : ''}">
      <button class="uw-connect-btn" onclick="saveUWToken()">‚ö° CONNECT UNUSUAL WHALES</button>
      <div style="margin-top:6px;font-size:7px;color:var(--dim);line-height:1.6">
        Get your token at <span style="color:var(--uw)">unusualwhales.com</span> ‚Üí Account ‚Üí API<br>
        Data: options flow alerts, dark pool prints, market tide
      </div>
    </div>`;
}

async function renderUWPanel(ticker = null) {
  const el = document.getElementById('uw-panel');
  if (!uwToken) {
    el.innerHTML = `
      <div class="uw-header">
        <span class="uw-logo">üê≥ UNUSUAL WHALES</span>
        <span class="uw-badge">OPTIONS FLOW</span>
      </div>
      ${renderUWKeySection()}
      <div class="uw-status">Connect your API token to see<br>live options flow & dark pool data</div>`;
    return;
  }

  el.innerHTML = `
    <div class="uw-header">
      <span class="uw-logo">üê≥ UNUSUAL WHALES</span>
      <span class="uw-badge" style="color:var(--uw)">LIVE</span>
    </div>
    ${ticker ? `<div style="font-size:9px;color:var(--uw);letter-spacing:2px;margin-bottom:10px">‚óà ${ticker} FLOW DATA</div>` : ''}
    <div id="uw-loading" class="uw-status">Loading flow data...</div>`;

  // Fetch flow for this ticker
  const sym = ticker || 'AAPL';
  const [flowData, dpData] = await Promise.all([
    uwFetch(`/api/stock/${sym}/flow-recent`),
    uwFetch(`/api/darkpool/${sym}`)
  ]);

  if (!flowData && !dpData) {
    el.innerHTML = `
      <div class="uw-header"><span class="uw-logo">üê≥ UNUSUAL WHALES</span></div>
      ${renderUWKeySection()}
      <div class="uw-status">Could not connect. Check token or try refreshing.<br><a onclick="uwToken='';localStorage.removeItem('uw_token');renderUWPanel()">Clear token</a></div>`;
    return;
  }

  let html = `
    <div class="uw-header">
      <span class="uw-logo">üê≥ UNUSUAL WHALES</span>
      <span class="uw-badge" style="color:var(--uw)">LIVE ‚óâ</span>
    </div>
    ${ticker ? `<div style="font-size:9px;color:var(--uw);letter-spacing:2px;margin-bottom:10px">‚óà ${ticker} FLOW DATA</div>` : ''}`;

  const flows = flowData?.data?.slice(0, 8) || [];
  if (flows.length > 0) {
    html += `<div class="dp-section-title" style="color:var(--uw)">RECENT OPTIONS FLOW</div>`;
    flows.forEach(f => {
      const prem = f.total_premium ? `$${(f.total_premium/1000).toFixed(0)}K` : '‚Äî';
      const isCall = f.type === 'CALL' || f.call_or_put === 'C';
      html += `
        <div class="uw-flow-item">
          <div class="uw-flow-top">
            <span class="uw-flow-sym">${f.ticker || sym}</span>
            <span class="uw-flow-type ${isCall ? 'uw-call' : 'uw-put'}">${isCall ? 'CALL' : 'PUT'}</span>
            <span style="font-size:8px;color:var(--dim)">${f.expiry || f.expiration || ''}</span>
            <span class="uw-flow-premium">${prem}</span>
          </div>
          <div class="uw-flow-detail">
            Strike $${f.strike || '‚Äî'} ¬∑ Size ${f.total_size || f.size || '‚Äî'} ¬∑ ${f.sentiment || (isCall ? 'BULLISH' : 'BEARISH')}
          </div>
        </div>`;
    });
  }

  const dps = dpData?.data?.slice(0, 6) || [];
  if (dps.length > 0) {
    html += `<div class="dp-section-title" style="color:var(--uw);margin-top:12px">DARK POOL PRINTS</div>`;
    dps.forEach(d => {
      const val = d.size && d.price ? `$${(d.size * d.price / 1e6).toFixed(2)}M` : '‚Äî';
      html += `
        <div class="uw-flow-item">
          <div class="uw-flow-top">
            <span class="uw-flow-sym">${d.ticker || sym}</span>
            <span style="font-size:8px;color:var(--dim)">DARK POOL</span>
            <span class="uw-flow-premium">${val}</span>
          </div>
          <div class="uw-flow-detail">
            Price $${d.price?.toFixed(2) || '‚Äî'} ¬∑ Size ${d.size?.toLocaleString() || '‚Äî'} ¬∑ ${new Date(d.executed_at || d.time).toLocaleTimeString()}
          </div>
        </div>`;
    });
  }

  if (flows.length === 0 && dps.length === 0) {
    html += `<div class="uw-status" style="color:var(--dim)">No recent flow data for ${sym}</div>`;
  }

  html += `<div style="margin-top:12px;font-size:7px;color:var(--dim);text-align:right">Via Unusual Whales API ¬∑ ${new Date().toLocaleTimeString()}</div>`;
  el.innerHTML = html;
}

async function renderUWMarketPanel() {
  const el = document.getElementById('uwmp-content');
  if (!uwToken) {
    el.innerHTML = `
      <div style="margin-bottom:16px">
        <div class="uw-key-label">CONNECT TO UNUSUAL WHALES</div>
        <input class="uw-key-input" id="uwmp-token-input" type="password" placeholder="Bearer token from unusualwhales.com" value="${uwToken ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : ''}">
        <button class="uw-connect-btn" onclick="document.getElementById('uw-token-input')&&(document.getElementById('uw-token-input').value=document.getElementById('uwmp-token-input').value);saveUWToken();renderUWMarketPanel()">‚ö° CONNECT</button>
      </div>
      <div class="uw-status">Live options flow ¬∑ Dark pool ¬∑ Market tide<br>Requires Unusual Whales API subscription</div>`;
    return;
  }

  el.innerHTML = '<div class="uw-status">Loading market-wide data...</div>';

  const [tideData, flowData, dpRecent] = await Promise.all([
    uwFetch('/api/market/market-tide', { interval_5m: false }),
    uwFetch('/api/option-trades/flow-alerts', { limit: 20, min_premium: 100000 }),
    uwFetch('/api/darkpool/recent')
  ]);

  let html = '';

  // Market Tide
  const tideItems = tideData?.data?.slice(-6) || [];
  if (tideItems.length > 0) {
    const last = tideItems[tideItems.length - 1];
    const callNet = last.net_call_premium || 0;
    const putNet = Math.abs(last.net_put_premium || 0);
    const total = callNet + putNet;
    const callPct = total > 0 ? (callNet / total * 100) : 50;
    html += `
      <div class="dp-section">
        <div class="dp-section-title" style="color:var(--uw)">MARKET TIDE // SENTIMENT</div>
        <div class="uw-tide-bar">
          <div class="uw-tide-call" style="width:${callPct}%"></div>
          <div class="uw-tide-put" style="width:${100-callPct}%"></div>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:8px;margin-bottom:10px">
          <span style="color:var(--gr)">CALLS ${callPct.toFixed(0)}%</span>
          <span style="color:var(--r)">PUTS ${(100-callPct).toFixed(0)}%</span>
        </div>
        <div class="dp-row"><span class="dp-key">NET CALL PREM</span><span class="dp-val hi">$${(callNet/1e6).toFixed(1)}M</span></div>
        <div class="dp-row"><span class="dp-key">NET PUT PREM</span><span class="dp-val lo">$${(putNet/1e6).toFixed(1)}M</span></div>
        <div class="dp-row"><span class="dp-key">SENTIMENT</span><span class="dp-val ${callNet > putNet ? 'hi' : 'lo'}">${callNet > putNet ? '‚ñ≤ BULLISH' : '‚ñº BEARISH'}</span></div>
      </div>`;
  }

  // Flow Alerts
  const flows = flowData?.data?.slice(0, 15) || [];
  if (flows.length > 0) {
    html += `<div class="dp-section-title" style="color:var(--uw)">BIGGEST FLOW ALERTS</div>`;
    flows.forEach(f => {
      const prem = f.total_premium ? `$${(f.total_premium/1000).toFixed(0)}K` : '‚Äî';
      const isCall = f.type === 'CALL' || f.call_or_put === 'C';
      html += `
        <div class="uw-flow-item">
          <div class="uw-flow-top">
            <span class="uw-flow-sym">${f.ticker}</span>
            <span class="uw-flow-type ${isCall ? 'uw-call' : 'uw-put'}">${isCall ? 'CALL' : 'PUT'}</span>
            <span style="font-size:8px;color:var(--dim)">x${f.expiry || ''}</span>
            <span class="uw-flow-premium">${prem}</span>
          </div>
          <div class="uw-flow-detail">Strike $${f.strike || '‚Äî'} ¬∑ ${f.sentiment || ''}</div>
        </div>`;
    });
  }

  // Dark Pool
  const dps = dpRecent?.data?.slice(0, 10) || [];
  if (dps.length > 0) {
    html += `<div class="dp-section-title" style="color:var(--uw);margin-top:12px">RECENT DARK POOL</div>`;
    dps.forEach(d => {
      const val = d.size && d.price ? `$${(d.size * d.price / 1e6).toFixed(2)}M` : '‚Äî';
      html += `
        <div class="uw-flow-item">
          <div class="uw-flow-top">
            <span class="uw-flow-sym">${d.ticker}</span>
            <span style="font-size:8px;color:var(--dim)">DARK POOL</span>
            <span class="uw-flow-premium">${val}</span>
          </div>
          <div class="uw-flow-detail">$${d.price?.toFixed(2) || '‚Äî'} √ó ${d.size?.toLocaleString() || '‚Äî'}</div>
        </div>`;
    });
  }

  if (!tideItems.length && !flows.length && !dps.length) {
    html = `<div class="uw-status">No data returned. Token may be invalid or rate limited.<br><a style="color:var(--uw);cursor:pointer" onclick="uwToken='';localStorage.removeItem('uw_token');renderUWMarketPanel()">Clear token</a></div>`;
  } else {
    html += `<div style="margin-top:12px;font-size:7px;color:var(--dim);text-align:right">Via Unusual Whales API ¬∑ ${new Date().toLocaleTimeString()}</div>`;
  }

  el.innerHTML = html;
}

function toggleUWPanel() {
  const p = document.getElementById('uw-market-panel');
  const isOpen = p.classList.contains('open');
  if (isOpen) {
    p.classList.remove('open');
    document.getElementById('btn-uw').classList.remove('active');
  } else {
    p.classList.add('open');
    document.getElementById('btn-uw').classList.add('active');
    renderUWMarketPanel();
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RUSSELL 3000 STOCK DATABASE
// Comprehensive coverage: ~500 key constituents across all sectors
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STOCK_DB = [
  // === MEGA CAP TECHNOLOGY ===
  {sym:'AAPL',name:'Apple Inc.',sector:'Technology',mktCapB:3720,pe:38.2,divYield:0.42,beta:1.24,high52:260.10,low52:164.08},
  {sym:'MSFT',name:'Microsoft Corp.',sector:'Technology',mktCapB:3260,pe:36.4,divYield:0.72,beta:0.89,high52:468.35,low52:362.90},
  {sym:'NVDA',name:'NVIDIA Corp.',sector:'Technology',mktCapB:3380,pe:65.2,divYield:0.03,beta:1.96,high52:153.13,low52:47.32},
  {sym:'GOOGL',name:'Alphabet Inc.',sector:'Technology',mktCapB:2150,pe:24.8,divYield:0,beta:1.04,high52:207.05,low52:140.53},
  {sym:'META',name:'Meta Platforms',sector:'Technology',mktCapB:1640,pe:29.3,divYield:0.30,beta:1.33,high52:740.91,low52:382.17},
  {sym:'AVGO',name:'Broadcom Inc.',sector:'Technology',mktCapB:1020,pe:42.1,divYield:1.04,beta:1.05,high52:251.88,low52:124.92},
  {sym:'TSM',name:'Taiwan Semiconductor',sector:'Technology',mktCapB:976,pe:31.5,divYield:1.28,beta:1.15,high52:226.40,low52:105.77},
  {sym:'ORCL',name:'Oracle Corp.',sector:'Technology',mktCapB:498,pe:40.2,divYield:0.93,beta:0.89,high52:198.31,low52:109.78},
  {sym:'CRM',name:'Salesforce Inc.',sector:'Technology',mktCapB:310,pe:51.8,divYield:0.48,beta:1.38,high52:369.00,low52:212.00},
  {sym:'AMD',name:'Advanced Micro Devices',sector:'Technology',mktCapB:215,pe:48.7,divYield:0,beta:1.78,high52:227.30,low52:117.96},
  {sym:'QCOM',name:'Qualcomm Inc.',sector:'Technology',mktCapB:174,pe:16.8,divYield:2.05,beta:1.28,high52:230.63,low52:147.10},
  {sym:'INTC',name:'Intel Corp.',sector:'Technology',mktCapB:88,pe:null,divYield:2.07,beta:0.95,high52:48.98,low52:17.67},
  {sym:'NOW',name:'ServiceNow Inc.',sector:'Technology',mktCapB:208,pe:122.3,divYield:0,beta:1.22,high52:1198.09,low52:668.37},
  {sym:'ANET',name:'Arista Networks',sector:'Technology',mktCapB:137,pe:54.9,divYield:0,beta:1.45,high52:133.52,low52:71.12},
  {sym:'PANW',name:'Palo Alto Networks',sector:'Technology',mktCapB:115,pe:180.4,divYield:0,beta:1.12,high52:410.43,low52:248.52},
  {sym:'SNOW',name:'Snowflake Inc.',sector:'Technology',mktCapB:53,pe:null,divYield:0,beta:1.89,high52:237.72,low52:107.13},
  {sym:'PLTR',name:'Palantir Technologies',sector:'Technology',mktCapB:218,pe:390.0,divYield:0,beta:2.12,high52:125.41,low52:16.61},
  {sym:'NET',name:'Cloudflare Inc.',sector:'Technology',mktCapB:49,pe:null,divYield:0,beta:1.78,high52:214.26,low52:53.94},
  {sym:'CRWD',name:'CrowdStrike Holdings',sector:'Technology',mktCapB:94,pe:null,divYield:0,beta:1.62,high52:398.33,low52:211.67},
  {sym:'DDOG',name:'Datadog Inc.',sector:'Technology',mktCapB:44,pe:null,divYield:0,beta:1.74,high52:190.61,low52:87.37},
  {sym:'MU',name:'Micron Technology',sector:'Technology',mktCapB:106,pe:22.4,divYield:0.46,beta:1.45,high52:157.54,low52:74.71},
  {sym:'TXN',name:'Texas Instruments',sector:'Technology',mktCapB:168,pe:36.2,divYield:2.80,beta:1.08,high52:220.39,low52:162.00},
  {sym:'ADBE',name:'Adobe Inc.',sector:'Technology',mktCapB:189,pe:26.4,divYield:0,beta:1.32,high52:638.25,low52:362.69},
  {sym:'INTU',name:'Intuit Inc.',sector:'Technology',mktCapB:168,pe:48.7,divYield:0.65,beta:1.22,high52:710.22,low52:448.22},
  {sym:'SHOP',name:'Shopify Inc.',sector:'Technology',mktCapB:138,pe:null,divYield:0,beta:1.92,high52:130.00,low52:53.73},
  {sym:'SQ',name:'Block Inc.',sector:'Technology',mktCapB:38,pe:null,divYield:0,beta:2.18,high52:99.00,low52:55.93},
  {sym:'UBER',name:'Uber Technologies',sector:'Technology',mktCapB:152,pe:28.4,divYield:0,beta:1.48,high52:87.00,low52:56.71},
  {sym:'LYFT',name:'Lyft Inc.',sector:'Technology',mktCapB:7.2,pe:null,divYield:0,beta:2.02,high52:21.94,low52:9.48},
  {sym:'TWLO',name:'Twilio Inc.',sector:'Technology',mktCapB:15,pe:null,divYield:0,beta:1.84,high52:115.00,low52:47.66},
  {sym:'ZS',name:'Zscaler Inc.',sector:'Technology',mktCapB:39,pe:null,divYield:0,beta:1.56,high52:276.06,low52:147.07},
  {sym:'OKTA',name:'Okta Inc.',sector:'Technology',mktCapB:16,pe:null,divYield:0,beta:1.78,high52:117.35,low52:60.90},
  {sym:'FTNT',name:'Fortinet Inc.',sector:'Technology',mktCapB:69,pe:47.8,divYield:0,beta:1.15,high52:105.91,low52:49.42},
  {sym:'ANSS',name:'ANSYS Inc.',sector:'Technology',mktCapB:30,pe:64.3,divYield:0,beta:1.28,high52:399.44,low52:281.80},
  {sym:'CDNS',name:'Cadence Design Systems',sector:'Technology',mktCapB:88,pe:73.2,divYield:0,beta:1.38,high52:316.44,low52:214.78},
  {sym:'SNPS',name:'Synopsys Inc.',sector:'Technology',mktCapB:82,pe:68.1,divYield:0,beta:1.02,high52:621.37,low52:448.48},
  {sym:'KLAC',name:'KLA Corp.',sector:'Technology',mktCapB:93,pe:34.2,divYield:0.94,beta:1.32,high52:877.50,low52:614.62},
  {sym:'LRCX',name:'Lam Research',sector:'Technology',mktCapB:97,pe:32.4,divYield:1.18,beta:1.52,high52:1134.00,low52:684.56},
  {sym:'AMAT',name:'Applied Materials',sector:'Technology',mktCapB:139,pe:24.8,divYield:0.90,beta:1.45,high52:265.09,low52:156.53},
  {sym:'ASML',name:'ASML Holding',sector:'Technology',mktCapB:289,pe:38.4,divYield:0.79,beta:1.18,high52:1110.09,low52:634.25},
  {sym:'HPQ',name:'HP Inc.',sector:'Technology',mktCapB:32,pe:10.2,divYield:3.26,beta:0.93,high52:39.89,low52:27.60},
  {sym:'DELL',name:'Dell Technologies',sector:'Technology',mktCapB:52,pe:22.4,divYield:1.38,beta:1.12,high52:179.70,low52:91.82},
  {sym:'HPE',name:'Hewlett Packard Ent.',sector:'Technology',mktCapB:25,pe:14.8,divYield:2.48,beta:1.08,high52:24.33,low52:16.05},
  {sym:'ACN',name:'Accenture plc',sector:'Technology',mktCapB:214,pe:30.2,divYield:1.52,beta:1.12,high52:399.03,low52:295.72},
  {sym:'IBM',name:'IBM Corp.',sector:'Technology',mktCapB:215,pe:28.4,divYield:3.22,beta:0.71,high52:240.33,low52:140.28},
  {sym:'CSCO',name:'Cisco Systems',sector:'Technology',mktCapB:250,pe:19.8,divYield:2.70,beta:0.80,high52:60.79,low52:43.43},
  {sym:'MSI',name:'Motorola Solutions',sector:'Technology',mktCapB:77,pe:43.8,divYield:0.91,beta:0.88,high52:488.71,low52:321.43},
  {sym:'FFIV',name:'F5 Inc.',sector:'Technology',mktCapB:16,pe:22.4,divYield:0,beta:1.08,high52:294.30,low52:183.58},
  {sym:'NLOK',name:'Gen Digital',sector:'Technology',mktCapB:17,pe:18.4,divYield:2.08,beta:0.72,high52:30.53,low52:19.46},
  {sym:'CTSH',name:'Cognizant Tech Solutions',sector:'Technology',mktCapB:37,pe:17.2,divYield:1.68,beta:1.02,high52:80.00,low52:55.00},
  {sym:'GEN',name:'Gen Digital Inc.',sector:'Technology',mktCapB:17,pe:18.4,divYield:2.08,beta:0.72,high52:30.53,low52:19.46},
  // === HEALTHCARE ===
  {sym:'LLY',name:'Eli Lilly & Co.',sector:'Healthcare',mktCapB:742,pe:62.4,divYield:0.61,beta:0.47,high52:972.53,low52:718.51},
  {sym:'UNH',name:'UnitedHealth Group',sector:'Healthcare',mktCapB:480,pe:22.3,divYield:1.60,beta:0.52,high52:611.34,low52:403.49},
  {sym:'JNJ',name:'Johnson & Johnson',sector:'Healthcare',mktCapB:362,pe:15.8,divYield:3.22,beta:0.55,high52:168.33,low52:138.62},
  {sym:'ABT',name:'Abbott Laboratories',sector:'Healthcare',mktCapB:188,pe:27.1,divYield:1.93,beta:0.69,high52:131.74,low52:93.82},
  {sym:'MRK',name:'Merck & Co.',sector:'Healthcare',mktCapB:218,pe:16.2,divYield:2.93,beta:0.38,high52:134.63,low52:92.06},
  {sym:'TMO',name:'Thermo Fisher Scientific',sector:'Healthcare',mktCapB:214,pe:33.8,divYield:0.29,beta:0.89,high52:623.00,low52:434.90},
  {sym:'ABBV',name:'AbbVie Inc.',sector:'Healthcare',mktCapB:318,pe:58.3,divYield:3.45,beta:0.65,high52:208.55,low52:155.83},
  {sym:'PFE',name:'Pfizer Inc.',sector:'Healthcare',mktCapB:154,pe:null,divYield:6.82,beta:0.43,high52:30.92,low52:22.49},
  {sym:'AMGN',name:'Amgen Inc.',sector:'Healthcare',mktCapB:167,pe:19.8,divYield:3.16,beta:0.52,high52:334.93,low52:254.79},
  {sym:'ISRG',name:'Intuitive Surgical',sector:'Healthcare',mktCapB:193,pe:78.6,divYield:0,beta:1.12,high52:598.55,low52:339.71},
  {sym:'GILD',name:'Gilead Sciences',sector:'Healthcare',mktCapB:124,pe:16.2,divYield:3.42,beta:0.38,high52:106.49,low52:64.90},
  {sym:'BSX',name:'Boston Scientific',sector:'Healthcare',mktCapB:124,pe:52.4,divYield:0,beta:0.98,high52:99.39,low52:58.69},
  {sym:'MDT',name:'Medtronic plc',sector:'Healthcare',mktCapB:99,pe:22.4,divYield:3.35,beta:0.68,high52:96.09,low52:74.45},
  {sym:'SYK',name:'Stryker Corp.',sector:'Healthcare',mktCapB:137,pe:40.2,divYield:1.02,beta:0.98,high52:392.69,low52:277.92},
  {sym:'EW',name:'Edwards Lifesciences',sector:'Healthcare',mktCapB:43,pe:30.4,divYield:0,beta:1.12,high52:103.89,low52:68.26},
  {sym:'ZBH',name:'Zimmer Biomet',sector:'Healthcare',mktCapB:13,pe:16.8,divYield:0.88,beta:0.94,high52:134.82,low52:100.11},
  {sym:'BAX',name:'Baxter International',sector:'Healthcare',mktCapB:14,pe:null,divYield:2.04,beta:0.64,high52:38.02,low52:23.23},
  {sym:'VRTX',name:'Vertex Pharmaceuticals',sector:'Healthcare',mktCapB:136,pe:34.8,divYield:0,beta:0.62,high52:528.16,low52:380.00},
  {sym:'REGN',name:'Regeneron Pharmaceuticals',sector:'Healthcare',mktCapB:86,pe:21.8,divYield:0,beta:0.52,high52:1164.00,low52:639.07},
  {sym:'BIIB',name:'Biogen Inc.',sector:'Healthcare',mktCapB:36,pe:22.4,divYield:0,beta:0.38,high52:307.39,low52:131.23},
  {sym:'MRNA',name:'Moderna Inc.',sector:'Healthcare',mktCapB:16,pe:null,divYield:0,beta:1.48,high52:167.34,low52:32.84},
  {sym:'HCA',name:'HCA Healthcare',sector:'Healthcare',mktCapB:88,pe:14.2,divYield:0.92,beta:0.88,high52:409.00,low52:276.21},
  {sym:'HUM',name:'Humana Inc.',sector:'Healthcare',mktCapB:52,pe:null,divYield:1.12,beta:0.48,high52:406.89,low52:197.67},
  {sym:'CI',name:'Cigna Group',sector:'Healthcare',mktCapB:93,pe:14.8,divYield:1.68,beta:0.44,high52:389.97,low52:269.71},
  {sym:'DVA',name:'DaVita Inc.',sector:'Healthcare',mktCapB:13,pe:16.2,divYield:0,beta:0.72,high52:175.04,low52:108.68},
  {sym:'IQV',name:'IQVIA Holdings',sector:'Healthcare',mktCapB:37,pe:28.4,divYield:0,beta:1.14,high52:253.91,low52:175.85},
  // === FINANCIALS ===
  {sym:'BRK-B',name:'Berkshire Hathaway B',sector:'Financials',mktCapB:1060,pe:23.1,divYield:0,beta:0.87,high52:494.16,low52:350.70},
  {sym:'JPM',name:'JPMorgan Chase',sector:'Financials',mktCapB:723,pe:13.8,divYield:2.12,beta:1.09,high52:280.25,low52:170.81},
  {sym:'V',name:'Visa Inc.',sector:'Financials',mktCapB:595,pe:32.4,divYield:0.77,beta:0.93,high52:316.00,low52:247.85},
  {sym:'MA',name:'Mastercard Inc.',sector:'Financials',mktCapB:474,pe:38.2,divYield:0.52,beta:1.04,high52:556.00,low52:423.25},
  {sym:'BAC',name:'Bank of America',sector:'Financials',mktCapB:344,pe:15.2,divYield:2.35,beta:1.33,high52:48.08,low52:31.37},
  {sym:'WFC',name:'Wells Fargo',sector:'Financials',mktCapB:271,pe:14.7,divYield:1.96,beta:1.26,high52:81.39,low52:50.14},
  {sym:'GS',name:'Goldman Sachs',sector:'Financials',mktCapB:198,pe:16.8,divYield:2.14,beta:1.28,high52:660.00,low52:380.00},
  {sym:'AXP',name:'American Express',sector:'Financials',mktCapB:207,pe:22.4,divYield:1.17,beta:1.15,high52:325.87,low52:192.29},
  {sym:'PYPL',name:'PayPal Holdings',sector:'Financials',mktCapB:73,pe:19.2,divYield:0,beta:1.55,high52:101.46,low52:57.59},
  {sym:'COF',name:'Capital One Financial',sector:'Financials',mktCapB:57,pe:14.3,divYield:1.88,beta:1.46,high52:199.39,low52:113.84},
  {sym:'MS',name:'Morgan Stanley',sector:'Financials',mktCapB:212,pe:18.4,divYield:3.12,beta:1.28,high52:137.47,low52:87.62},
  {sym:'C',name:'Citigroup Inc.',sector:'Financials',mktCapB:142,pe:18.2,divYield:3.16,beta:1.38,high52:84.15,low52:43.68},
  {sym:'USB',name:'U.S. Bancorp',sector:'Financials',mktCapB:72,pe:14.2,divYield:4.24,beta:0.98,high52:52.59,low52:33.39},
  {sym:'PNC',name:'PNC Financial Services',sector:'Financials',mktCapB:74,pe:13.8,divYield:3.64,beta:1.08,high52:213.00,low52:138.18},
  {sym:'TFC',name:'Truist Financial',sector:'Financials',mktCapB:60,pe:14.2,divYield:4.94,beta:1.12,high52:47.59,low52:29.10},
  {sym:'SCHW',name:'Charles Schwab',sector:'Financials',mktCapB:129,pe:32.4,divYield:1.38,beta:1.12,high52:82.40,low52:53.32},
  {sym:'BLK',name:'BlackRock Inc.',sector:'Financials',mktCapB:156,pe:24.4,divYield:2.08,beta:1.28,high52:1082.99,low52:742.62},
  {sym:'SPGI',name:'S&P Global Inc.',sector:'Financials',mktCapB:151,pe:44.8,divYield:0.76,beta:1.08,high52:509.67,low52:398.95},
  {sym:'MCO',name:"Moody's Corp.",sector:'Financials',mktCapB:86,pe:42.8,divYield:0.82,beta:1.08,high52:502.50,low52:341.32},
  {sym:'ICE',name:'Intercontinental Exchange',sector:'Financials',mktCapB:90,pe:34.8,divYield:1.08,beta:0.98,high52:180.96,low52:129.50},
  {sym:'CME',name:'CME Group',sector:'Financials',mktCapB:82,pe:24.8,divYield:4.82,beta:0.52,high52:239.89,low52:185.19},
  {sym:'FIS',name:'Fidelity Natl Info',sector:'Financials',mktCapB:40,pe:14.8,divYield:2.44,beta:0.94,high52:100.69,low52:55.78},
  {sym:'FISV',name:'Fiserv Inc.',sector:'Financials',mktCapB:102,pe:32.8,divYield:0,beta:0.98,high52:218.51,low52:133.95},
  {sym:'NDAQ',name:'Nasdaq Inc.',sector:'Financials',mktCapB:46,pe:34.8,divYield:1.48,beta:1.18,high52:79.21,low52:52.90},
  {sym:'AFL',name:'Aflac Inc.',sector:'Financials',mktCapB:56,pe:14.2,divYield:2.12,beta:0.74,high52:107.41,low52:78.15},
  {sym:'PRU',name:'Prudential Financial',sector:'Financials',mktCapB:39,pe:14.8,divYield:4.98,beta:1.18,high52:115.16,low52:83.31},
  {sym:'ALL',name:'Allstate Corp.',sector:'Financials',mktCapB:55,pe:14.2,divYield:2.06,beta:0.72,high52:196.62,low52:131.89},
  {sym:'TRV',name:'Travelers Cos.',sector:'Financials',mktCapB:57,pe:14.2,divYield:1.78,beta:0.64,high52:262.44,low52:192.42},
  {sym:'HIG',name:'Hartford Financial',sector:'Financials',mktCapB:33,pe:12.4,divYield:1.84,beta:0.72,high52:132.80,low52:88.43},
  {sym:'MET',name:'MetLife Inc.',sector:'Financials',mktCapB:52,pe:12.4,divYield:3.34,beta:1.12,high52:88.51,low52:62.15},
  // === CONSUMER CYCLICAL ===
  {sym:'AMZN',name:'Amazon.com Inc.',sector:'Consumer Cyclical',mktCapB:2390,pe:47.8,divYield:0,beta:1.27,high52:242.52,low52:151.61},
  {sym:'TSLA',name:'Tesla Inc.',sector:'Consumer Cyclical',mktCapB:985,pe:98.4,divYield:0,beta:2.14,high52:488.54,low52:138.80},
  {sym:'HD',name:'Home Depot',sector:'Consumer Cyclical',mktCapB:346,pe:25.8,divYield:2.36,beta:0.96,high52:439.37,low52:305.62},
  {sym:'MCD',name:"McDonald's Corp.",sector:'Consumer Cyclical',mktCapB:203,pe:23.4,divYield:2.30,beta:0.72,high52:317.90,low52:243.50},
  {sym:'NKE',name:'Nike Inc.',sector:'Consumer Cyclical',mktCapB:95,pe:28.4,divYield:2.15,beta:1.05,high52:115.21,low52:70.83},
  {sym:'SBUX',name:'Starbucks Corp.',sector:'Consumer Cyclical',mktCapB:102,pe:32.7,divYield:2.42,beta:0.88,high52:117.00,low52:71.54},
  {sym:'TGT',name:'Target Corp.',sector:'Consumer Cyclical',mktCapB:56,pe:14.8,divYield:3.55,beta:0.79,high52:181.86,low52:109.77},
  {sym:'LOW',name:"Lowe's Companies",sector:'Consumer Cyclical',mktCapB:139,pe:22.1,divYield:2.00,beta:0.97,high52:271.79,low52:188.96},
  {sym:'GM',name:'General Motors',sector:'Consumer Cyclical',mktCapB:50,pe:5.6,divYield:1.22,beta:1.56,high52:61.53,low52:38.49},
  {sym:'F',name:'Ford Motor Co.',sector:'Consumer Cyclical',mktCapB:47,pe:11.2,divYield:6.43,beta:1.45,high52:14.85,low52:9.84},
  {sym:'BKNG',name:'Booking Holdings',sector:'Consumer Cyclical',mktCapB:174,pe:28.4,divYield:0,beta:1.38,high52:5275.00,low52:3217.77},
  {sym:'MAR',name:'Marriott International',sector:'Consumer Cyclical',mktCapB:74,pe:28.4,divYield:0.94,beta:1.34,high52:288.12,low52:205.25},
  {sym:'HLT',name:'Hilton Worldwide',sector:'Consumer Cyclical',mktCapB:62,pe:44.2,divYield:0.32,beta:1.28,high52:257.77,low52:175.02},
  {sym:'CCL',name:'Carnival Corp.',sector:'Consumer Cyclical',mktCapB:26,pe:22.4,divYield:0,beta:2.28,high52:26.34,low52:14.55},
  {sym:'RCL',name:'Royal Caribbean',sector:'Consumer Cyclical',mktCapB:69,pe:28.4,divYield:0.74,beta:2.08,high52:261.14,low52:117.98},
  {sym:'ABNB',name:'Airbnb Inc.',sector:'Consumer Cyclical',mktCapB:87,pe:42.4,divYield:0,beta:1.52,high52:173.41,low52:113.00},
  {sym:'ETSY',name:'Etsy Inc.',sector:'Consumer Cyclical',mktCapB:7.4,pe:18.4,divYield:0,beta:1.92,high52:90.31,low52:51.30},
  {sym:'EBAY',name:'eBay Inc.',sector:'Consumer Cyclical',mktCapB:32,pe:14.8,divYield:2.08,beta:1.02,high52:67.88,low52:43.38},
  {sym:'DASH',name:'DoorDash Inc.',sector:'Consumer Cyclical',mktCapB:63,pe:null,divYield:0,beta:1.72,high52:220.26,low52:85.89},
  {sym:'EXPE',name:'Expedia Group',sector:'Consumer Cyclical',mktCapB:21,pe:18.4,divYield:0,beta:1.58,high52:186.42,low52:133.00},
  // === CONSUMER DEFENSIVE ===
  {sym:'PG',name:'Procter & Gamble',sector:'Consumer Defensive',mktCapB:368,pe:24.8,divYield:2.43,beta:0.54,high52:180.43,low52:153.92},
  {sym:'KO',name:'Coca-Cola Co.',sector:'Consumer Defensive',mktCapB:285,pe:27.1,divYield:3.06,beta:0.61,high52:73.53,low52:56.17},
  {sym:'PEP',name:'PepsiCo Inc.',sector:'Consumer Defensive',mktCapB:207,pe:21.8,divYield:3.59,beta:0.52,high52:183.42,low52:142.67},
  {sym:'WMT',name:'Walmart Inc.',sector:'Consumer Defensive',mktCapB:739,pe:38.3,divYield:1.00,beta:0.63,high52:105.30,low52:65.75},
  {sym:'COST',name:'Costco Wholesale',sector:'Consumer Defensive',mktCapB:390,pe:56.8,divYield:0.52,beta:0.97,high52:1078.23,low52:693.00},
  {sym:'MDLZ',name:'Mondelez International',sector:'Consumer Defensive',mktCapB:82,pe:21.4,divYield:2.58,beta:0.66,high52:76.93,low52:57.91},
  {sym:'PM',name:'Philip Morris Intl',sector:'Consumer Defensive',mktCapB:218,pe:19.8,divYield:4.16,beta:0.64,high52:145.65,low52:82.08},
  {sym:'MO',name:'Altria Group',sector:'Consumer Defensive',mktCapB:87,pe:10.2,divYield:8.42,beta:0.58,high52:59.30,low52:38.02},
  {sym:'CL',name:'Colgate-Palmolive',sector:'Consumer Defensive',mktCapB:55,pe:28.4,divYield:2.38,beta:0.58,high52:102.98,low52:77.77},
  {sym:'KMB',name:'Kimberly-Clark',sector:'Consumer Defensive',mktCapB:46,pe:22.4,divYield:3.60,beta:0.52,high52:148.44,low52:114.93},
  {sym:'GIS',name:'General Mills',sector:'Consumer Defensive',mktCapB:35,pe:14.2,divYield:3.56,beta:0.42,high52:73.00,low52:59.38},
  {sym:'K',name:'Kellanova',sector:'Consumer Defensive',mktCapB:29,pe:28.4,divYield:3.08,beta:0.52,high52:78.81,low52:57.86},
  {sym:'CAG',name:'ConAgra Brands',sector:'Consumer Defensive',mktCapB:13,pe:14.2,divYield:5.42,beta:0.48,high52:33.88,low52:25.41},
  {sym:'HRL',name:'Hormel Foods',sector:'Consumer Defensive',mktCapB:11,pe:21.4,divYield:4.28,beta:0.32,high52:35.56,low52:26.44},
  {sym:'STZ',name:'Constellation Brands',sector:'Consumer Defensive',mktCapB:39,pe:22.4,divYield:1.84,beta:0.74,high52:267.55,low52:192.47},
  {sym:'TAP',name:'Molson Coors Beverage',sector:'Consumer Defensive',mktCapB:11,pe:10.2,divYield:3.42,beta:0.68,high52:67.83,low52:49.56},
  {sym:'SYY',name:'Sysco Corp.',sector:'Consumer Defensive',mktCapB:37,pe:21.4,divYield:2.74,beta:0.92,high52:82.59,low52:67.84},
  {sym:'KR',name:'Kroger Co.',sector:'Consumer Defensive',mktCapB:42,pe:16.2,divYield:2.08,beta:0.62,high52:68.85,low52:47.42},
  {sym:'ACI',name:'Albertsons Companies',sector:'Consumer Defensive',mktCapB:12,pe:14.2,divYield:2.98,beta:0.52,high52:24.79,low52:17.23},
  // === INDUSTRIALS ===
  {sym:'GE',name:'GE Aerospace',sector:'Industrials',mktCapB:218,pe:39.4,divYield:0.70,beta:1.12,high52:218.71,low52:102.96},
  {sym:'CAT',name:'Caterpillar Inc.',sector:'Industrials',mktCapB:168,pe:17.8,divYield:1.53,beta:1.04,high52:418.50,low52:280.57},
  {sym:'HON',name:'Honeywell Intl',sector:'Industrials',mktCapB:133,pe:24.3,divYield:2.12,beta:0.91,high52:229.67,low52:183.89},
  {sym:'RTX',name:'RTX Corp.',sector:'Industrials',mktCapB:147,pe:34.1,divYield:2.24,beta:0.83,high52:130.78,low52:86.93},
  {sym:'BA',name:'Boeing Co.',sector:'Industrials',mktCapB:112,pe:null,divYield:0,beta:1.23,high52:211.03,low52:137.02},
  {sym:'LMT',name:'Lockheed Martin',sector:'Industrials',mktCapB:115,pe:17.1,divYield:2.88,beta:0.53,high52:619.40,low52:413.92},
  {sym:'UPS',name:'United Parcel Service',sector:'Industrials',mktCapB:117,pe:19.8,divYield:5.45,beta:0.98,high52:148.69,low52:103.92},
  {sym:'DE',name:'Deere & Co.',sector:'Industrials',mktCapB:116,pe:14.2,divYield:1.69,beta:0.87,high52:470.89,low52:346.73},
  {sym:'ETN',name:'Eaton Corp.',sector:'Industrials',mktCapB:145,pe:37.2,divYield:1.04,beta:1.18,high52:385.50,low52:214.12},
  {sym:'NOC',name:'Northrop Grumman',sector:'Industrials',mktCapB:74,pe:18.4,divYield:1.58,beta:0.52,high52:551.96,low52:418.83},
  {sym:'GD',name:'General Dynamics',sector:'Industrials',mktCapB:72,pe:20.4,divYield:2.18,beta:0.52,high52:306.10,low52:236.55},
  {sym:'MMM',name:'3M Co.',sector:'Industrials',mktCapB:64,pe:18.4,divYield:1.78,beta:0.94,high52:148.90,low52:85.71},
  {sym:'FDX',name:'FedEx Corp.',sector:'Industrials',mktCapB:66,pe:16.2,divYield:2.22,beta:1.18,high52:319.89,low52:226.39},
  {sym:'WM',name:'Waste Management',sector:'Industrials',mktCapB:79,pe:34.8,divYield:1.52,beta:0.74,high52:228.40,low52:186.59},
  {sym:'RSG',name:'Republic Services',sector:'Industrials',mktCapB:62,pe:38.4,divYield:1.48,beta:0.78,high52:231.92,low52:171.32},
  {sym:'ODFL',name:'Old Dominion Freight',sector:'Industrials',mktCapB:44,pe:32.4,divYield:0.52,beta:1.08,high52:229.39,low52:154.31},
  {sym:'JBHT',name:'J.B. Hunt Transport',sector:'Industrials',mktCapB:17,pe:28.4,divYield:1.12,beta:1.08,high52:221.04,low52:143.01},
  {sym:'CSX',name:'CSX Corp.',sector:'Industrials',mktCapB:62,pe:18.4,divYield:1.42,beta:1.12,high52:38.88,low52:28.07},
  {sym:'NSC',name:'Norfolk Southern',sector:'Industrials',mktCapB:61,pe:22.4,divYield:2.22,beta:1.08,high52:258.91,low52:200.58},
  {sym:'UNP',name:'Union Pacific',sector:'Industrials',mktCapB:138,pe:22.4,divYield:2.30,beta:1.02,high52:265.20,low52:204.96},
  {sym:'EMR',name:'Emerson Electric',sector:'Industrials',mktCapB:64,pe:24.8,divYield:2.18,beta:1.08,high52:123.45,low52:88.52},
  {sym:'ROK',name:'Rockwell Automation',sector:'Industrials',mktCapB:24,pe:28.4,divYield:2.24,beta:1.32,high52:313.93,low52:218.32},
  {sym:'IR',name:'Ingersoll Rand',sector:'Industrials',mktCapB:38,pe:38.4,divYield:0.18,beta:1.28,high52:104.05,low52:70.43},
  {sym:'CARR',name:'Carrier Global',sector:'Industrials',mktCapB:57,pe:28.4,divYield:0.78,beta:1.22,high52:72.57,low52:52.22},
  {sym:'OTIS',name:'Otis Worldwide',sector:'Industrials',mktCapB:38,pe:28.4,divYield:1.48,beta:0.88,high52:102.38,low52:79.63},
  {sym:'PWR',name:'Quanta Services',sector:'Industrials',mktCapB:49,pe:42.8,divYield:0.18,beta:1.38,high52:327.60,low52:203.88},
  {sym:'FAST',name:'Fastenal Co.',sector:'Industrials',mktCapB:53,pe:48.8,divYield:2.22,beta:0.98,high52:83.45,low52:58.00},
  {sym:'GWW',name:'W.W. Grainger',sector:'Industrials',mktCapB:46,pe:28.4,divYield:0.78,beta:1.02,high52:1137.41,low52:830.07},
  // === ENERGY ===
  {sym:'XOM',name:'Exxon Mobil',sector:'Energy',mktCapB:507,pe:14.2,divYield:3.68,beta:0.95,high52:126.34,low52:97.62},
  {sym:'CVX',name:'Chevron Corp.',sector:'Energy',mktCapB:263,pe:15.8,divYield:4.54,beta:0.99,high52:168.96,low52:131.85},
  {sym:'SLB',name:'SLB (Schlumberger)',sector:'Energy',mktCapB:45,pe:14.1,divYield:2.78,beta:1.48,high52:61.68,low52:33.94},
  {sym:'EOG',name:'EOG Resources',sector:'Energy',mktCapB:72,pe:12.1,divYield:3.03,beta:1.23,high52:142.63,low52:110.94},
  {sym:'OXY',name:'Occidental Petroleum',sector:'Energy',mktCapB:48,pe:12.8,divYield:1.85,beta:1.38,high52:73.42,low52:42.45},
  {sym:'COP',name:'ConocoPhillips',sector:'Energy',mktCapB:132,pe:14.8,divYield:3.12,beta:1.14,high52:138.34,low52:99.40},
  {sym:'PSX',name:'Phillips 66',sector:'Energy',mktCapB:53,pe:10.8,divYield:3.62,beta:1.28,high52:175.10,low52:119.13},
  {sym:'MPC',name:'Marathon Petroleum',sector:'Energy',mktCapB:62,pe:8.2,divYield:2.34,beta:1.32,high52:228.41,low52:155.91},
  {sym:'VLO',name:'Valero Energy',sector:'Energy',mktCapB:43,pe:9.8,divYield:3.22,beta:1.28,high52:185.58,low52:131.79},
  {sym:'KMI',name:'Kinder Morgan',sector:'Energy',mktCapB:26,pe:22.4,divYield:5.82,beta:0.98,high52:27.40,low52:16.63},
  {sym:'WMB',name:'Williams Companies',sector:'Energy',mktCapB:54,pe:28.4,divYield:4.02,beta:1.08,high52:53.58,low52:29.91},
  {sym:'OKE',name:'ONEOK Inc.',sector:'Energy',mktCapB:52,pe:22.8,divYield:4.48,beta:1.18,high52:123.50,low52:68.64},
  {sym:'HAL',name:'Halliburton Co.',sector:'Energy',mktCapB:29,pe:12.4,divYield:2.28,beta:1.68,high52:40.00,low52:25.62},
  {sym:'BKR',name:'Baker Hughes',sector:'Energy',mktCapB:38,pe:22.4,divYield:2.48,beta:1.28,high52:43.65,low52:28.44},
  {sym:'DVN',name:'Devon Energy',sector:'Energy',mktCapB:14,pe:8.2,divYield:5.88,beta:1.58,high52:55.76,low52:27.99},
  {sym:'FANG',name:'Diamondback Energy',sector:'Energy',mktCapB:41,pe:10.2,divYield:4.22,beta:1.38,high52:211.65,low52:154.13},
  // === MATERIALS ===
  {sym:'LIN',name:'Linde plc',sector:'Materials',mktCapB:219,pe:34.8,divYield:1.22,beta:0.79,high52:494.57,low52:401.47},
  {sym:'APD',name:'Air Products & Chem.',sector:'Materials',mktCapB:64,pe:22.1,divYield:2.91,beta:0.78,high52:357.32,low52:217.10},
  {sym:'NEM',name:'Newmont Corp.',sector:'Materials',mktCapB:51,pe:null,divYield:2.29,beta:0.64,high52:58.72,low52:34.34},
  {sym:'FCX',name:'Freeport-McMoRan',sector:'Materials',mktCapB:58,pe:21.4,divYield:0.74,beta:1.89,high52:60.70,low52:34.39},
  {sym:'NUE',name:'Nucor Corp.',sector:'Materials',mktCapB:21,pe:11.2,divYield:1.84,beta:1.22,high52:218.10,low52:127.73},
  {sym:'STLD',name:'Steel Dynamics',sector:'Materials',mktCapB:19,pe:10.8,divYield:1.42,beta:1.28,high52:151.45,low52:97.96},
  {sym:'ALB',name:'Albemarle Corp.',sector:'Materials',mktCapB:9,pe:null,divYield:1.08,beta:1.52,high52:196.58,low52:59.74},
  {sym:'CE',name:'Celanese Corp.',sector:'Materials',mktCapB:7,pe:null,divYield:2.82,beta:1.38,high52:169.00,low52:63.73},
  {sym:'DD',name:'DuPont de Nemours',sector:'Materials',mktCapB:30,pe:28.4,divYield:1.88,beta:1.08,high52:86.76,low52:63.06},
  {sym:'IFF',name:'Intl Flavors & Frag.',sector:'Materials',mktCapB:16,pe:null,divYield:4.28,beta:0.72,high52:89.48,low52:60.63},
  {sym:'PPG',name:'PPG Industries',sector:'Materials',mktCapB:26,pe:18.4,divYield:2.22,beta:0.98,high52:155.00,low52:110.89},
  {sym:'SHW',name:'Sherwin-Williams',sector:'Materials',mktCapB:90,pe:34.8,divYield:0.84,beta:1.08,high52:402.98,low52:286.90},
  {sym:'IP',name:'International Paper',sector:'Materials',mktCapB:22,pe:28.4,divYield:2.94,beta:0.98,high52:63.82,low52:34.77},
  {sym:'WRK',name:'WestRock Co.',sector:'Materials',mktCapB:8,pe:null,divYield:3.12,beta:1.12,high52:55.04,low52:35.17},
  // === REAL ESTATE ===
  {sym:'AMT',name:'American Tower',sector:'Real Estate',mktCapB:96,pe:42.8,divYield:3.06,beta:0.72,high52:229.00,low52:159.00},
  {sym:'PLD',name:'Prologis Inc.',sector:'Real Estate',mktCapB:109,pe:35.2,divYield:3.16,beta:1.05,high52:138.04,low52:96.38},
  {sym:'EQIX',name:'Equinix Inc.',sector:'Real Estate',mktCapB:79,pe:87.3,divYield:2.06,beta:0.67,high52:1001.68,low52:681.18},
  {sym:'CCI',name:'Crown Castle Inc.',sector:'Real Estate',mktCapB:45,pe:34.1,divYield:6.29,beta:0.76,high52:120.94,low52:83.48},
  {sym:'O',name:'Realty Income Corp.',sector:'Real Estate',mktCapB:52,pe:44.2,divYield:5.63,beta:0.84,high52:67.47,low52:50.73},
  {sym:'WELL',name:'Welltower Inc.',sector:'Real Estate',mktCapB:97,pe:128.4,divYield:1.82,beta:0.78,high52:134.00,low52:82.53},
  {sym:'SPG',name:'Simon Property Group',sector:'Real Estate',mktCapB:58,pe:22.4,divYield:5.18,beta:1.28,high52:173.62,low52:130.39},
  {sym:'VTR',name:'Ventas Inc.',sector:'Real Estate',mktCapB:29,pe:null,divYield:3.38,beta:0.94,high52:62.55,low52:44.01},
  {sym:'AVB',name:'AvalonBay Communities',sector:'Real Estate',mktCapB:36,pe:34.8,divYield:3.18,beta:0.82,high52:253.77,low52:193.11},
  {sym:'EQR',name:'Equity Residential',sector:'Real Estate',mktCapB:28,pe:34.8,divYield:3.90,beta:0.88,high52:74.75,low52:58.84},
  {sym:'PSA',name:'Public Storage',sector:'Real Estate',mktCapB:54,pe:38.4,divYield:4.22,beta:0.84,high52:349.25,low52:256.56},
  {sym:'EXR',name:'Extra Space Storage',sector:'Real Estate',mktCapB:32,pe:42.4,divYield:4.38,beta:0.88,high52:175.29,low52:127.96},
  {sym:'WPC',name:'W. P. Carey Inc.',sector:'Real Estate',mktCapB:13,pe:28.4,divYield:5.82,beta:0.82,high52:71.39,low52:49.11},
  {sym:'SBAC',name:'SBA Communications',sector:'Real Estate',mktCapB:22,pe:62.4,divYield:1.74,beta:0.68,high52:257.27,low52:182.67},
  // === UTILITIES ===
  {sym:'NEE',name:'NextEra Energy',sector:'Utilities',mktCapB:147,pe:20.3,divYield:3.11,beta:0.56,high52:85.11,low52:56.03},
  {sym:'SO',name:'Southern Co.',sector:'Utilities',mktCapB:87,pe:22.4,divYield:3.56,beta:0.51,high52:92.13,low52:68.01},
  {sym:'DUK',name:'Duke Energy',sector:'Utilities',mktCapB:86,pe:21.8,divYield:3.89,beta:0.40,high52:122.03,low52:93.85},
  {sym:'AEP',name:'AEP Ohio',sector:'Utilities',mktCapB:52,pe:18.2,divYield:3.82,beta:0.43,high52:103.51,low52:79.21},
  {sym:'D',name:'Dominion Energy',sector:'Utilities',mktCapB:40,pe:24.8,divYield:4.90,beta:0.46,high52:54.18,low52:34.26},
  {sym:'EXC',name:'Exelon Corp.',sector:'Utilities',mktCapB:38,pe:18.4,divYield:4.08,beta:0.42,high52:44.27,low52:32.15},
  {sym:'XEL',name:'Xcel Energy',sector:'Utilities',mktCapB:34,pe:18.4,divYield:3.54,beta:0.44,high52:66.50,low52:51.50},
  {sym:'WEC',name:'WEC Energy Group',sector:'Utilities',mktCapB:28,pe:21.4,divYield:3.42,beta:0.38,high52:103.59,low52:78.94},
  {sym:'ES',name:'Eversource Energy',sector:'Utilities',mktCapB:19,pe:18.4,divYield:4.62,beta:0.42,high52:71.54,low52:50.04},
  {sym:'ETR',name:'Entergy Corp.',sector:'Utilities',mktCapB:25,pe:22.4,divYield:4.22,beta:0.42,high52:130.80,low52:91.03},
  {sym:'PEG',name:'PSEG',sector:'Utilities',mktCapB:34,pe:18.4,divYield:3.18,beta:0.52,high52:84.43,low52:60.94},
  {sym:'PCG',name:'PG&E Corp.',sector:'Utilities',mktCapB:38,pe:18.4,divYield:0,beta:0.68,high52:22.02,low52:15.55},
  {sym:'PPL',name:'PPL Corp.',sector:'Utilities',mktCapB:19,pe:18.4,divYield:3.26,beta:0.72,high52:30.95,low52:24.43},
  {sym:'LNT',name:'Alliant Energy',sector:'Utilities',mktCapB:14,pe:18.4,divYield:3.54,beta:0.44,high52:55.22,low52:43.39},
  {sym:'AEE',name:'Ameren Corp.',sector:'Utilities',mktCapB:22,pe:21.4,divYield:3.22,beta:0.44,high52:93.31,low52:68.91},
  // === COMMUNICATION SERVICES ===
  {sym:'NFLX',name:'Netflix Inc.',sector:'Communication Services',mktCapB:449,pe:58.9,divYield:0,beta:1.18,high52:1064.50,low52:542.01},
  {sym:'SPOT',name:'Spotify Technology',sector:'Communication Services',mktCapB:89,pe:138.4,divYield:0,beta:1.34,high52:632.54,low52:170.98},
  {sym:'DIS',name:'Walt Disney Co.',sector:'Communication Services',mktCapB:198,pe:31.8,divYield:0.42,beta:1.05,high52:123.74,low52:84.78},
  {sym:'CMCSA',name:'Comcast Corp.',sector:'Communication Services',mktCapB:170,pe:11.2,divYield:3.18,beta:0.99,high52:45.30,low52:36.31},
  {sym:'T',name:'AT&T Inc.',sector:'Communication Services',mktCapB:175,pe:18.4,divYield:5.23,beta:0.71,high52:27.75,low52:16.20},
  {sym:'VZ',name:'Verizon Communications',sector:'Communication Services',mktCapB:177,pe:11.8,divYield:6.89,beta:0.38,high52:45.15,low52:37.16},
  {sym:'TMUS',name:'T-Mobile US',sector:'Communication Services',mktCapB:292,pe:28.4,divYield:1.48,beta:0.58,high52:248.43,low52:148.20},
  {sym:'CHTR',name:'Charter Communications',sector:'Communication Services',mktCapB:50,pe:28.4,divYield:0,beta:1.08,high52:462.50,low52:296.16},
  {sym:'PARA',name:'Paramount Global',sector:'Communication Services',mktCapB:8,pe:null,divYield:0,beta:1.38,high52:18.29,low52:9.16},
  {sym:'WBD',name:'Warner Bros. Discovery',sector:'Communication Services',mktCapB:22,pe:null,divYield:0,beta:1.42,high52:14.49,low52:6.84},
  {sym:'FOX',name:'Fox Corp.',sector:'Communication Services',mktCapB:24,pe:14.2,divYield:1.48,beta:0.82,high52:48.39,low52:28.96},
  {sym:'OMC',name:'Omnicom Group',sector:'Communication Services',mktCapB:19,pe:14.2,divYield:3.22,beta:0.88,high52:103.15,low52:77.62},
  {sym:'IPG',name:'Interpublic Group',sector:'Communication Services',mktCapB:13,pe:14.2,divYield:4.28,beta:0.88,high52:34.97,low52:23.85},
  {sym:'TTWO',name:'Take-Two Interactive',sector:'Communication Services',mktCapB:28,pe:null,divYield:0,beta:1.42,high52:178.71,low52:130.15},
  {sym:'EA',name:'Electronic Arts',sector:'Communication Services',mktCapB:36,pe:28.4,divYield:0.68,beta:0.78,high52:144.69,low52:110.25},
  {sym:'ATVI',name:'Activision Blizzard',sector:'Communication Services',mktCapB:72,pe:38.4,divYield:0,beta:0.58,high52:95.00,low52:76.76},
  {sym:'PINS',name:'Pinterest Inc.',sector:'Communication Services',mktCapB:19,pe:28.4,divYield:0,beta:1.18,high52:43.35,low52:24.24},
  {sym:'SNAP',name:'Snap Inc.',sector:'Communication Services',mktCapB:20,pe:null,divYield:0,beta:1.72,high52:16.98,low52:7.89},
  {sym:'MTCH',name:'Match Group',sector:'Communication Services',mktCapB:8,pe:18.4,divYield:0,beta:1.42,high52:46.31,low52:20.85},
  {sym:'ZG',name:'Zillow Group',sector:'Communication Services',mktCapB:14,pe:null,divYield:0,beta:1.62,high52:78.07,low52:41.10},
  {sym:'RBLX',name:'Roblox Corp.',sector:'Communication Services',mktCapB:37,pe:null,divYield:0,beta:1.92,high52:53.95,low52:29.27},
  {sym:'ROKU',name:'Roku Inc.',sector:'Communication Services',mktCapB:16,pe:null,divYield:0,beta:2.02,high52:96.73,low52:42.57},
  // === ADDITIONAL R3000 MID/SMALL CAPS ===
  {sym:'AXON',name:'Axon Enterprise',sector:'Industrials',mktCapB:47,pe:120.4,divYield:0,beta:1.42,high52:673.00,low52:202.15},
  {sym:'TRMB',name:'Trimble Inc.',sector:'Technology',mktCapB:18,pe:34.8,divYield:0,beta:1.28,high52:73.19,low52:46.25},
  {sym:'NXST',name:'Nexstar Media',sector:'Communication Services',mktCapB:5,pe:10.2,divYield:3.88,beta:1.02,high52:181.56,low52:136.42},
  {sym:'SIRI',name:'Sirius XM Holdings',sector:'Communication Services',mktCapB:8,pe:14.8,divYield:4.32,beta:0.62,high52:3.32,low52:2.13},
  {sym:'WBA',name:'Walgreens Boots Alliance',sector:'Healthcare',mktCapB:4,pe:null,divYield:4.18,beta:0.54,high52:27.89,low52:8.73},
  {sym:'CVS',name:'CVS Health Corp.',sector:'Healthcare',mktCapB:56,pe:12.4,divYield:4.28,beta:0.62,high52:73.34,low52:47.43},
  {sym:'MCK',name:'McKesson Corp.',sector:'Healthcare',mktCapB:78,pe:24.8,divYield:0.48,beta:0.52,high52:700.68,low52:465.73},
  {sym:'ABC',name:'AmerisourceBergen',sector:'Healthcare',mktCapB:43,pe:22.4,divYield:1.22,beta:0.52,high52:233.30,low52:172.46},
  {sym:'CAH',name:'Cardinal Health',sector:'Healthcare',mktCapB:24,pe:14.8,divYield:2.22,beta:0.52,high52:135.72,low52:95.26},
  {sym:'DAL',name:'Delta Air Lines',sector:'Industrials',mktCapB:33,pe:14.2,divYield:1.28,beta:1.52,high52:66.98,low52:36.73},
  {sym:'UAL',name:'United Airlines',sector:'Industrials',mktCapB:18,pe:8.2,divYield:0,beta:1.68,high52:102.78,low52:37.07},
  {sym:'AAL',name:'American Airlines',sector:'Industrials',mktCapB:8,pe:8.2,divYield:0,beta:1.82,high52:17.65,low52:9.07},
  {sym:'LUV',name:'Southwest Airlines',sector:'Industrials',mktCapB:18,pe:28.4,divYield:2.18,beta:1.22,high52:35.75,low52:22.86},
  {sym:'ALK',name:'Alaska Air Group',sector:'Industrials',mktCapB:7,pe:12.4,divYield:0,beta:1.48,high52:65.64,low52:36.03},
  {sym:'WDAY',name:'Workday Inc.',sector:'Technology',mktCapB:68,pe:null,divYield:0,beta:1.42,high52:281.21,low52:196.39},
  {sym:'HUBS',name:'HubSpot Inc.',sector:'Technology',mktCapB:29,pe:null,divYield:0,beta:1.48,high52:726.73,low52:362.64},
  {sym:'BILL',name:'Bill Holdings',sector:'Technology',mktCapB:6,pe:null,divYield:0,beta:1.82,high52:132.29,low52:42.55},
  {sym:'ZI',name:'ZoomInfo Technologies',sector:'Technology',mktCapB:4,pe:null,divYield:0,beta:1.62,high52:22.67,low52:7.65},
  {sym:'PCTY',name:'Paylocity Holding',sector:'Technology',mktCapB:12,pe:48.4,divYield:0,beta:1.28,high52:218.73,low52:145.55},
  {sym:'PAYC',name:'Paycom Software',sector:'Technology',mktCapB:10,pe:28.4,divYield:1.48,beta:1.38,high52:193.79,low52:130.61},
  {sym:'VEEV',name:'Veeva Systems',sector:'Healthcare',mktCapB:40,pe:68.4,divYield:0,beta:0.88,high52:265.00,low52:159.04},
  {sym:'PODD',name:'Insulet Corp.',sector:'Healthcare',mktCapB:15,pe:88.4,divYield:0,beta:1.02,high52:267.13,low52:163.76},
  {sym:'ALGN',name:'Align Technology',sector:'Healthcare',mktCapB:14,pe:42.8,divYield:0,beta:1.48,high52:363.97,low52:215.07},
  {sym:'HOLX',name:'Hologic Inc.',sector:'Healthcare',mktCapB:16,pe:18.4,divYield:0,beta:0.62,high52:88.18,low52:68.88},
  {sym:'WAT',name:'Waters Corp.',sector:'Healthcare',mktCapB:17,pe:28.4,divYield:0,beta:0.82,high52:407.52,low52:277.50},
  {sym:'MTD',name:'Mettler-Toledo',sector:'Healthcare',mktCapB:19,pe:38.4,divYield:0,beta:0.88,high52:1697.00,low52:1117.77},
  {sym:'IDXX',name:'IDEXX Laboratories',sector:'Healthcare',mktCapB:44,pe:52.4,divYield:0,beta:0.88,high52:580.42,low52:380.00},
  {sym:'COO',name:'Cooper Companies',sector:'Healthcare',mktCapB:15,pe:42.4,divYield:0.02,beta:0.88,high52:106.91,low52:77.55},
  {sym:'RMD',name:'ResMed Inc.',sector:'Healthcare',mktCapB:37,pe:38.4,divYield:0.92,beta:0.62,high52:248.76,low52:162.02},
  {sym:'BDX',name:'Becton Dickinson',sector:'Healthcare',mktCapB:73,pe:28.4,divYield:1.52,beta:0.72,high52:249.40,low52:205.29},
  {sym:'PHM',name:'PulteGroup',sector:'Consumer Cyclical',mktCapB:20,pe:8.2,divYield:0.92,beta:1.58,high52:147.07,low52:87.44},
  {sym:'DHI',name:'D.R. Horton',sector:'Consumer Cyclical',mktCapB:52,pe:10.2,divYield:0.98,beta:1.52,high52:175.84,low52:112.95},
  {sym:'LEN',name:'Lennar Corp.',sector:'Consumer Cyclical',mktCapB:36,pe:10.8,divYield:1.22,beta:1.42,high52:195.78,low52:129.22},
  {sym:'TOL',name:'Toll Brothers',sector:'Consumer Cyclical',mktCapB:14,pe:10.8,divYield:0.68,beta:1.48,high52:159.47,low52:87.43},
  {sym:'NVR',name:'NVR Inc.',sector:'Consumer Cyclical',mktCapB:21,pe:18.4,divYield:0,beta:0.98,high52:8823.00,low52:6200.00},
  {sym:'POOL',name:'Pool Corp.',sector:'Consumer Cyclical',mktCapB:16,pe:32.4,divYield:1.28,beta:1.08,high52:439.00,low52:318.69},
  {sym:'SWK',name:'Stanley Black & Decker',sector:'Industrials',mktCapB:11,pe:28.4,divYield:3.72,beta:1.28,high52:99.43,low52:64.10},
  {sym:'MKTX',name:'MarketAxess Holdings',sector:'Financials',mktCapB:8,pe:28.4,divYield:1.38,beta:0.88,high52:270.00,low52:173.91},
  {sym:'IBKR',name:'Interactive Brokers',sector:'Financials',mktCapB:40,pe:22.4,divYield:0.32,beta:1.22,high52:185.40,low52:88.01},
  {sym:'LPLA',name:'LPL Financial',sector:'Financials',mktCapB:23,pe:28.4,divYield:0.28,beta:0.98,high52:335.88,low52:201.02},
  {sym:'SF',name:'Stifel Financial',sector:'Financials',mktCapB:10,pe:18.4,divYield:1.48,beta:1.12,high52:102.97,low52:67.24},
  {sym:'RJF',name:'Raymond James Financial',sector:'Financials',mktCapB:29,pe:16.4,divYield:1.22,beta:1.08,high52:173.67,low52:112.32},
];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RUNTIME STATE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let liveData = {};
let allStocks = [];
let filtered = [];
let sortKey = 'mktCap';
let sortDir = -1;
let currentView = 'table';
let dpChart = null;
let selectedSym = null;

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SECTOR BADGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function sectorBadge(s) {
  const map = {
    'Technology':'badge-tech','Healthcare':'badge-health','Financials':'badge-fin',
    'Energy':'badge-energy','Consumer Cyclical':'badge-consumer','Consumer Defensive':'badge-consumer',
    'Industrials':'badge-ind','Materials':'badge-mat','Real Estate':'badge-re',
    'Utilities':'badge-util','Communication Services':'badge-comm'
  };
  const ab = {
    'Technology':'TECH','Healthcare':'HLTH','Financials':'FIN','Energy':'ENRG',
    'Consumer Cyclical':'CYCD','Consumer Defensive':'DEFN','Industrials':'INDS',
    'Materials':'MATL','Real Estate':'RE','Utilities':'UTIL','Communication Services':'COMM'
  };
  return `<span class="badge ${map[s]||''}">${ab[s]||s.slice(0,4).toUpperCase()}</span>`;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// YAHOO FINANCE FETCH
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchYahooQuotes(symbols) {
  const chunk = symbols.join(',');
  const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${encodeURIComponent(chunk)}&fields=regularMarketPrice,regularMarketChangePercent,regularMarketChange,regularMarketVolume,averageDailyVolume3Month,regularMarketDayHigh,regularMarketDayLow,regularMarketOpen,regularMarketPreviousClose,trailingPE,forwardPE,dividendYield,beta,marketCap,fiftyTwoWeekHigh,fiftyTwoWeekLow,trailingAnnualDividendYield,regularMarketTime,marketState`;
  const endpoints = [
    url,
    `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
    `https://corsproxy.io/?${encodeURIComponent(url)}`,
  ];
  for (const ep of endpoints) {
    try {
      const resp = await fetch(ep, {signal: AbortSignal.timeout(8000)});
      if (!resp.ok) continue;
      const data = await resp.json();
      const results = data?.quoteResponse?.result || [];
      results.forEach(q => {
        liveData[q.symbol] = {
          price: q.regularMarketPrice,
          chg: q.regularMarketChange,
          chgPct: q.regularMarketChangePercent,
          volume: q.regularMarketVolume,
          avgVol: q.averageDailyVolume3Month,
          open: q.regularMarketOpen,
          prevClose: q.regularMarketPreviousClose,
          dayHigh: q.regularMarketDayHigh,
          dayLow: q.regularMarketDayLow,
          marketCap: q.marketCap,
          pe: q.trailingPE || q.forwardPE,
          divYield: (q.trailingAnnualDividendYield||q.dividendYield||0)*100,
          beta: q.beta,
          h52: q.fiftyTwoWeekHigh,
          l52: q.fiftyTwoWeekLow,
          marketState: q.marketState,
        };
      });
      return true;
    } catch(e) {}
  }
  return false;
}

async function fetchSparkline(sym) {
  const now = Math.floor(Date.now()/1000);
  const start = now - 86400;
  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=5m&period1=${start}&period2=${now}`;
  const proxied = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
  try {
    const resp = await fetch(proxied, {signal: AbortSignal.timeout(6000)});
    if (!resp.ok) return null;
    const d = await resp.json();
    return d?.chart?.result?.[0]?.indicators?.quote?.[0]?.close?.filter(v=>v!=null) || null;
  } catch(e) { return null; }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// INIT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setLoadMsg(m, pct) {
  document.getElementById('load-msg').textContent = m;
  if (pct !== undefined) document.getElementById('load-bar').style.width = pct + '%';
}

async function init() {
  setLoadMsg('LOADING RUSSELL 3000 DATABASE...', 5);
  const syms = [...new Set(STOCK_DB.map(s=>s.sym))]; // deduplicate

  const BATCH = 25;
  for (let i=0; i<syms.length; i+=BATCH) {
    const batch = syms.slice(i, i+BATCH);
    await fetchYahooQuotes(batch);
    const pct = 5 + (i/syms.length) * 80;
    setLoadMsg(`FETCHING LIVE PRICES... ${Math.min(i+BATCH, syms.length)}/${syms.length} STOCKS`, pct);
  }

  setLoadMsg('MERGING DATA STREAMS...', 88);
  allStocks = STOCK_DB.map(s => {
    const live = liveData[s.sym] || {};
    return {
      ...s,
      price: live.price || (s.high52 * 0.88),
      chg: live.chg || 0,
      chgPct: live.chgPct || 0,
      volume: live.volume || 0,
      avgVol: live.avgVol || 1,
      mktCap: live.marketCap ? live.marketCap/1e9 : s.mktCapB,
      pe: live.pe || s.pe,
      divYield: live.divYield !== undefined ? live.divYield : s.divYield,
      beta: live.beta || s.beta,
      h52: live.h52 || s.high52,
      l52: live.l52 || s.low52,
      open: live.open,
      prevClose: live.prevClose,
      dayHigh: live.dayHigh,
      dayLow: live.dayLow,
      marketState: live.marketState || 'REGULAR',
    };
  });

  const states = allStocks.map(s=>s.marketState).filter(Boolean);
  const mState = states[0] || 'REGULAR';
  document.getElementById('bb-market').textContent = mState==='REGULAR' ? 'OPEN' : mState==='PRE' ? 'PRE-MARKET' : 'AFTER-HOURS';
  document.getElementById('bb-market').style.color = mState==='REGULAR' ? 'var(--gr)' : 'var(--g)';

  filtered = [...allStocks];
  document.getElementById('bb-total').textContent = allStocks.length;
  document.getElementById('bb-update').textContent = new Date().toLocaleTimeString();

  // UW status
  if (uwToken) {
    document.getElementById('bb-uw').textContent = 'TOKEN LOADED';
    document.getElementById('bb-uw').style.color = 'var(--uw)';
  }

  setLoadMsg('RENDERING INTERFACE...', 95);
  await new Promise(r=>setTimeout(r,100));

  renderTable();
  renderMarketTicker();
  startClock();

  setLoadMsg('MERIDIAN ONLINE', 100);
  await new Promise(r=>setTimeout(r,300));
  document.getElementById('loading').style.display='none';
  document.getElementById('app').style.display='flex';

  // Initial UW panel render
  renderUWPanel();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SCREEN + SORT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function runScreen() {
  const sector = document.getElementById('f-sector').value;
  const mktcap = document.getElementById('f-mktcap').value;
  const peMax = parseFloat(document.getElementById('f-pe').value) || null;
  const divMin = parseFloat(document.getElementById('f-div').value) || null;
  const chg = document.getElementById('f-chg').value;
  const vol = document.getElementById('f-vol').value;
  const w52 = document.getElementById('f-52w').value;
  const search = document.getElementById('f-search').value.toLowerCase().trim();

  filtered = allStocks.filter(s => {
    if (sector && s.sector !== sector) return false;
    if (mktcap) {
      const cap = s.mktCap;
      if (mktcap==='mega' && cap < 200) return false;
      if (mktcap==='large' && (cap < 10 || cap >= 200)) return false;
      if (mktcap==='mid' && (cap < 2 || cap >= 10)) return false;
      if (mktcap==='small' && cap >= 2) return false;
    }
    if (peMax && (!s.pe || s.pe > peMax)) return false;
    if (divMin && (!s.divYield || s.divYield < divMin)) return false;
    if (chg) {
      if (chg==='up3' && s.chgPct < 3) return false;
      if (chg==='up1' && s.chgPct < 1) return false;
      if (chg==='dn1' && s.chgPct > -1) return false;
      if (chg==='dn3' && s.chgPct > -3) return false;
    }
    if (vol) {
      const ratio = s.avgVol ? s.volume / s.avgVol : 0;
      if (vol==='2x' && ratio < 2) return false;
      if (vol==='3x' && ratio < 3) return false;
    }
    if (w52 && s.h52 && s.l52) {
      const pct52 = (s.price - s.l52) / (s.h52 - s.l52) * 100;
      if (w52==='near_high' && pct52 < 90) return false;
      if (w52==='near_low' && pct52 > 15) return false;
    }
    if (search) {
      const q = search.toUpperCase();
      if (!s.sym.includes(q) && !s.name.toLowerCase().includes(search)) return false;
    }
    return true;
  });

  document.getElementById('result-count').textContent = `${filtered.length} RESULTS`;
  renderTable();
}

function sortBy(key) {
  if (sortKey === key) sortDir *= -1;
  else { sortKey = key; sortDir = -1; }
  renderTable();
}

function renderTable() {
  filtered.sort((a,b) => {
    const av = a[sortKey] ?? -Infinity;
    const bv = b[sortKey] ?? -Infinity;
    return (av - bv) * sortDir;
  });

  const tbody = document.getElementById('screener-body');
  tbody.innerHTML = '';
  const frag = document.createDocumentFragment();

  filtered.forEach(s => {
    const tr = document.createElement('tr');
    if (s.sym === selectedSym) tr.classList.add('selected');
    const chgCls = s.chgPct > 0 ? 'up' : s.chgPct < 0 ? 'dn' : 'neutral';
    const pct52 = s.h52 && s.l52 ? ((s.price - s.l52)/(s.h52 - s.l52)*100) : null;
    const volRatio = s.avgVol ? s.volume/s.avgVol : 0;
    const whaleTag = volRatio > 2.5 ? '<span class="whale-tag">üê≥ VOL</span>' : '';

    tr.innerHTML = `
      <td><div class="sym-cell"><div class="sym">${s.sym}${whaleTag}</div><div class="sname">${s.name}</div></div></td>
      <td class="neutral">$${s.price?.toFixed(2)||'‚Äî'}</td>
      <td class="${chgCls}">${s.chgPct>=0?'+':''}${s.chgPct?.toFixed(2)||'0.00'}%</td>
      <td class="gold">${fmtCap(s.mktCap)}</td>
      <td class="neutral">${s.pe?s.pe.toFixed(1):'‚Äî'}</td>
      <td class="${s.divYield>4?'up':'neutral'}">${s.divYield?s.divYield.toFixed(2)+'%':'‚Äî'}</td>
      <td class="${s.beta>1.5?'dn':s.beta<0.6?'up':'neutral'}">${s.beta?s.beta.toFixed(2):'‚Äî'}</td>
      <td class="neutral">${fmtVol(s.volume)}</td>
      <td class="up">$${s.h52?.toFixed(2)||'‚Äî'}</td>
      <td class="dn">$${s.l52?.toFixed(2)||'‚Äî'}</td>`;
    tr.onclick = () => selectStock(s);
    frag.appendChild(tr);
  });

  tbody.appendChild(frag);
  document.getElementById('result-count').textContent = `${filtered.length} RESULTS`;
}

function fmtCap(b) {
  if (!b) return '‚Äî';
  if (b >= 1000) return `$${(b/1000).toFixed(1)}T`;
  if (b >= 1) return `$${b.toFixed(1)}B`;
  return `$${(b*1000).toFixed(0)}M`;
}

function fmtVol(v) {
  if (!v) return '‚Äî';
  if (v >= 1e9) return `${(v/1e9).toFixed(1)}B`;
  if (v >= 1e6) return `${(v/1e6).toFixed(1)}M`;
  if (v >= 1e3) return `${(v/1e3).toFixed(0)}K`;
  return v.toString();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DETAIL PANEL
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function dpTab(name) {
  ['stats','buffett','analysis','uw'].forEach(t => {
    document.getElementById(`pane-${t}`).classList.toggle('active', t===name);
    document.getElementById(`tab-${t}`).classList.toggle('active', t===name);
  });
  if (name === 'uw' && selectedSym) renderUWPanel(selectedSym);
}

async function selectStock(s) {
  selectedSym = s.sym;
  // Highlight selected row
  document.querySelectorAll('#screener-body tr').forEach(r => {
    r.classList.toggle('selected', r.querySelector('.sym')?.textContent.replace(/üê≥ VOL/,'').trim() === s.sym);
  });

  document.getElementById('dp-sym').textContent = s.sym;
  document.getElementById('dp-name').textContent = s.name + ' ¬∑ ' + s.sector;
  document.getElementById('dp-price').textContent = s.price ? '$' + s.price.toFixed(2) : '‚Äî';

  const chgEl = document.getElementById('dp-chg');
  chgEl.textContent = s.chgPct ? (s.chgPct >= 0 ? '+' : '') + s.chgPct.toFixed(2) + '%' : '';
  chgEl.className = s.chgPct > 0 ? 'up' : s.chgPct < 0 ? 'dn' : 'neutral';

  document.getElementById('dp-state').textContent = s.marketState === 'PRE' ? 'PRE-MARKET' : s.marketState === 'POST' ? 'AFTER-HOURS' : '';

  const pct52 = s.h52 && s.l52 ? ((s.price-s.l52)/(s.h52-s.l52)*100) : null;

  document.getElementById('dp-stats').innerHTML = `
    <div class="dp-section">
      <div class="dp-section-title">PRICE</div>
      <div class="dp-row"><span class="dp-key">OPEN</span><span class="dp-val">${s.open?'$'+s.open.toFixed(2):'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">PREV CLOSE</span><span class="dp-val">${s.prevClose?'$'+s.prevClose.toFixed(2):'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">DAY RANGE</span><span class="dp-val">${s.dayLow&&s.dayHigh?'$'+s.dayLow.toFixed(2)+' ‚Äì $'+s.dayHigh.toFixed(2):'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">52W HIGH</span><span class="dp-val hi">${s.h52?'$'+s.h52.toFixed(2):'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">52W LOW</span><span class="dp-val lo">${s.l52?'$'+s.l52.toFixed(2):'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">52W POSITION</span><span class="dp-val">${pct52!==null?pct52.toFixed(0)+'%':'‚Äî'}</span></div>
    </div>
    <div class="dp-section">
      <div class="dp-section-title">FUNDAMENTALS</div>
      <div class="dp-row"><span class="dp-key">MKT CAP</span><span class="dp-val gold">${fmtCap(s.mktCap)}</span></div>
      <div class="dp-row"><span class="dp-key">P/E RATIO</span><span class="dp-val">${s.pe?s.pe.toFixed(1):'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">DIV YIELD</span><span class="dp-val ${s.divYield>3?'hi':''}">${s.divYield?s.divYield.toFixed(2)+'%':'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">BETA</span><span class="dp-val ${s.beta>1.5?'lo':s.beta<0.7?'hi':''}">${s.beta?s.beta.toFixed(2):'‚Äî'}</span></div>
      <div class="dp-row"><span class="dp-key">VOLUME</span><span class="dp-val">${fmtVol(s.volume)}</span></div>
      <div class="dp-row"><span class="dp-key">AVG VOLUME</span><span class="dp-val">${fmtVol(s.avgVol)}</span></div>
    </div>`;

  const prices = await fetchSparkline(s.sym);
  renderDpChart(prices, s);

  // Analysis
  document.getElementById('dp-ai-text').textContent = generateAnalysis(s);

  // Buffett
  renderBuffettPanel(s);

  // UW (only if on that tab)
  if (document.getElementById('pane-uw').classList.contains('active')) {
    renderUWPanel(s.sym);
  }
}

function generateAnalysis(s) {
  const pct52 = s.h52 && s.l52 ? ((s.price-s.l52)/(s.h52-s.l52)*100) : null;
  const volRatio = s.avgVol ? s.volume/s.avgVol : null;
  const parts = [];

  if (s.chgPct > 3) parts.push(`Strong upward momentum (+${s.chgPct.toFixed(1)}%) indicates positive market sentiment.`);
  else if (s.chgPct < -3) parts.push(`Notable decline (${s.chgPct.toFixed(1)}%) may present a buying opportunity for long-term investors.`);

  if (pct52 !== null) {
    if (pct52 > 90) parts.push(`Trading near 52-week highs ‚Äî momentum is strong but watch for resistance.`);
    else if (pct52 < 15) parts.push(`Near 52-week lows ‚Äî potential value territory if fundamentals remain intact.`);
  }

  if (s.divYield > 4) parts.push(`High dividend yield (${s.divYield.toFixed(1)}%) provides income cushion.`);
  if (s.pe && s.pe < 15) parts.push(`Low P/E of ${s.pe.toFixed(1)} suggests undervaluation relative to peers.`);
  if (s.pe && s.pe > 60) parts.push(`Elevated P/E of ${s.pe.toFixed(1)} reflects high growth expectations ‚Äî valuation risk exists.`);
  if (s.beta > 1.5) parts.push(`High beta (${s.beta.toFixed(2)}) ‚Äî volatile, amplifies both gains and losses.`);
  if (volRatio && volRatio > 2) parts.push(`Volume ${volRatio.toFixed(1)}x above average ‚Äî unusual activity detected. Check the üê≥ Whales tab.`);

  if (parts.length === 0) parts.push(`${s.name} is trading within normal ranges. Monitor earnings and sector trends for catalysts.`);

  return parts.join(' ');
}

function renderDpChart(prices, stock) {
  const canvas = document.getElementById('dp-chart');
  if (dpChart) { dpChart.destroy(); dpChart = null; }
  if (!prices || prices.length < 2) {
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'rgba(240,180,41,0.3)';
    ctx.font = '9px JetBrains Mono';
    ctx.textAlign = 'center';
    ctx.fillText('CHART DATA UNAVAILABLE', canvas.width/2, 50);
    return;
  }
  const up = prices[prices.length-1] >= prices[0];
  const color = up ? '#2ed573' : '#ff4757';
  dpChart = new Chart(canvas, {
    type:'line',
    data:{
      labels: prices.map((_,i)=>i),
      datasets:[{
        data: prices,
        borderColor: color,
        borderWidth: 1.5,
        pointRadius: 0,
        fill: true,
        backgroundColor: (ctx) => {
          const g = ctx.chart.ctx.createLinearGradient(0,0,0,120);
          g.addColorStop(0, color+'44'); g.addColorStop(1, color+'00');
          return g;
        },
        tension: 0.3,
      }]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{
        callbacks:{label:(i)=>'$'+i.raw.toFixed(2)},
        titleFont:{family:'JetBrains Mono'},
        bodyFont:{family:'JetBrains Mono'},
        backgroundColor:'rgba(5,8,16,0.9)',
        borderColor:'rgba(240,180,41,0.3)',
        borderWidth:1,
      }},
      scales:{
        x:{display:false},
        y:{
          display:true, position:'right',
          grid:{color:'rgba(240,180,41,0.05)'},
          ticks:{color:'#6b5e3f',font:{family:'JetBrains Mono',size:8},callback:(v)=>'$'+v.toFixed(0)},
        }
      }
    }
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// HEATMAP
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderHeatmap() {
  const el = document.getElementById('heatmap-view');
  el.innerHTML = '';
  const sorted = [...filtered].sort((a,b) => b.mktCap - a.mktCap);
  sorted.forEach(s => {
    const div = document.createElement('div');
    div.className = 'hm-cell';
    const pct = s.chgPct || 0;
    const intensity = Math.min(Math.abs(pct) / 5, 1);
    const r = pct < 0 ? Math.round(255 * intensity) : 0;
    const g = pct > 0 ? Math.round(120 * intensity) : 0;
    div.style.background = `rgba(${r},${g},0,0.3)`;
    div.style.border = `1px solid rgba(${r},${g},0,${0.2 + intensity * 0.4})`;
    const cap = s.mktCap;
    const sz = cap > 1000 ? 80 : cap > 200 ? 64 : cap > 50 ? 52 : 46;
    div.style.width = sz + 'px';
    div.style.height = Math.round(sz*0.75) + 'px';
    div.innerHTML = `<span class="hm-sym" style="font-size:${sz>60?10:8}px">${s.sym}</span>
      <span class="hm-chg" style="color:${pct>0?'var(--gr)':pct<0?'var(--r)':'var(--text)'}">${pct>=0?'+':''}${pct.toFixed(1)}%</span>`;
    div.onclick = () => { switchView('table'); selectStock(s); };
    el.appendChild(div);
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// MARKET TICKER
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderMarketTicker() {
  const tickers = ['SPY','QQQ','IWM','DIA','GLD','TLT','BTC-USD'];
  const el = document.getElementById('market-ticker');
  el.innerHTML = '';
  fetchYahooQuotes(tickers).then(()=>{
    el.innerHTML = '';
    tickers.forEach(sym => {
      const d = liveData[sym];
      if (!d) return;
      const div = document.createElement('div');
      div.className = 'tick-item';
      div.innerHTML = `<span class="tick-sym">${sym}</span><span class="tick-price">$${d.price?.toFixed(2)||'‚Äî'}</span>
        <span class="tick-chg ${(d.chgPct||0)>=0?'up':'dn'}">${(d.chgPct||0)>=0?'+':''}${(d.chgPct||0).toFixed(2)}%</span>`;
      el.appendChild(div);
    });
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// VIEW SWITCHING
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchView(v) {
  currentView = v;
  document.getElementById('btn-table').classList.toggle('active', v==='table');
  document.getElementById('btn-heat').classList.toggle('active', v==='heat');
  document.getElementById('table-wrap').style.display = v==='table' ? 'block' : 'none';
  const hm = document.getElementById('heatmap-view');
  hm.classList.toggle('visible', v==='heat');
  if (v==='heat') renderHeatmap();
  else renderTable();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CLOCK
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startClock() {
  function update() {
    const et = new Date().toLocaleTimeString('en-US',{timeZone:'America/New_York',hour12:false});
    document.getElementById('clock').textContent = et+' ET';
  }
  update(); setInterval(update, 1000);
}

window.addEventListener('load', init);
</script>
</body>
</html>
